<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è - –ú–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è 444</title>
  <style>
    /* –°–ë–†–û–° –°–¢–ò–õ–ï–ô */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      background: white;
      font-family: "Segoe UI", Roboto, -apple-system, BlinkMacSystemFont, Arial, sans-serif;
      font-size: 13px;
      line-height: 1.3;
    }

    /* HEADER */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(90deg, #0077e6 0%, #005bb5 100%);
      color: #fff;
      z-index: 1200;
      box-shadow: 0 3px 8px rgba(3, 36, 74, 0.12);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 12px;
      width: 100%;
      height: 55px;
    }

    .logo a {
      font-weight: 700;
      font-size: 1rem;
      color: #fff;
      text-decoration: none;
      white-space: nowrap;
    }

    nav {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: flex-end;
      flex: 1;
    }

    nav a {
      color: rgba(255, 255, 255, 0.95);
      text-decoration: none;
      padding: 5px 7px;
      border-radius: 5px;
      font-weight: 600;
      transition: all 0.22s;
      font-size: 0.8rem;
      white-space: nowrap;
    }

    nav a:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: translateY(-1px);
    }

    nav a.active {
      background: rgba(255, 255, 255, 0.15);
      font-weight: 700;
    }

    .logout-btn {
      background: rgba(220, 53, 69, 0.9);
      color: white;
      padding: 5px 8px;
      border-radius: 5px;
      text-decoration: none;
      font-weight: 600;
      font-size: 0.75rem;
      border: none;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.3s ease;
      margin-left: 5px;
    }

    .logout-btn:hover {
      background: #dc3545;
      transform: translateY(-1px);
    }

    .user-mini {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-left: 5px;
      color: white;
      font-weight: 600;
      font-size: 0.8rem;
    }

    /* –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ */
    .main-content {
      padding-top: 55px;
      min-height: 100vh;
      background: white;
    }

    .notifications-page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 20px 15px 40px;
      animation: fadeIn 0.6s ease;
      background: white;
    }

    /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .page-title {
      color: #003366;
      font-size: 1.4rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .page-icon {
      font-size: 1.6rem;
    }

    /* –§–∏–ª—å—Ç—Ä—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
    .notifications-filters {
      display: flex;
      gap: 10px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 8px 16px;
      border-radius: 8px;
      background: #f8fbff;
      border: 1.5px solid #e8f4ff;
      color: #003366;
      font-weight: 600;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.22s ease;
      white-space: nowrap;
    }

    .filter-btn:hover {
      background: #e8f4ff;
      transform: translateY(-1px);
    }

    .filter-btn.active {
      background: #007bff;
      color: white;
      border-color: #007bff;
    }

    .actions-container {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .mark-all-btn {
      padding: 8px 16px;
      border-radius: 8px;
      background: #28a745;
      color: white;
      border: none;
      font-weight: 600;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.22s ease;
      white-space: nowrap;
    }

    .mark-all-btn:hover {
      background: #218838;
      transform: translateY(-1px);
    }

    .clear-all-btn {
      padding: 8px 16px;
      border-radius: 8px;
      background: #dc3545;
      color: white;
      border: none;
      font-weight: 600;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.22s ease;
      white-space: nowrap;
    }

    .clear-all-btn:hover {
      background: #c82333;
      transform: translateY(-1px);
    }

    /* –°–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
    .notifications-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 30px;
    }

    .notification-card {
      background: white;
      border-radius: 12px;
      padding: 18px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.06);
      border: 1.5px solid #e8f4ff;
      display: flex;
      gap: 15px;
      align-items: flex-start;
      transition: all 0.22s ease;
      animation: slideIn 0.3s ease;
    }

    .notification-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 123, 255, 0.1);
      border-color: #007bff;
    }

    .notification-card.unread {
      background: #f0f8ff;
      border-left: 4px solid #007bff;
    }

    .notification-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      flex-shrink: 0;
    }

    .notification-icon.invitation {
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
      color: white;
    }

    .notification-icon.achievement {
      background: linear-gradient(135deg, #FF9800, #F57C00);
      color: white;
    }

    .notification-icon.system {
      background: linear-gradient(135deg, #9C27B0, #7B1FA2);
      color: white;
    }

    .notification-icon.warning {
      background: linear-gradient(135deg, #F44336, #D32F2F);
      color: white;
    }

    .notification-icon.info {
      background: linear-gradient(135deg, #2196F3, #1976D2);
      color: white;
    }

    .notification-content {
      flex: 1;
      min-width: 0;
    }

    .notification-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
      flex-wrap: wrap;
      gap: 8px;
    }

    .notification-title {
      color: #003366;
      margin: 0;
      font-size: 0.9rem;
      font-weight: 700;
      flex: 1;
      min-width: 0;
      word-break: break-word;
    }

    .notification-time {
      color: #666;
      font-size: 0.7rem;
      white-space: nowrap;
    }

    .notification-message {
      color: #555;
      font-size: 0.8rem;
      line-height: 1.4;
      margin-bottom: 12px;
      word-break: break-word;
    }

    .notification-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .notification-action-btn {
      padding: 6px 12px;
      border-radius: 6px;
      text-decoration: none;
      font-size: 0.75rem;
      font-weight: 600;
      transition: all 0.22s ease;
      border: none;
      cursor: pointer;
      white-space: nowrap;
    }

    .notification-action-btn.primary {
      background: #007bff;
      color: white;
      border: 1px solid #007bff;
    }

    .notification-action-btn.primary:hover {
      background: #0056b3;
      transform: translateY(-1px);
    }

    .notification-action-btn.secondary {
      background: transparent;
      color: #007bff;
      border: 1px solid #007bff;
    }

    .notification-action-btn.secondary:hover {
      background: #007bff;
      color: white;
      transform: translateY(-1px);
    }

    .notification-action-btn.danger {
      background: transparent;
      color: #dc3545;
      border: 1px solid #dc3545;
    }

    .notification-action-btn.danger:hover {
      background: #dc3545;
      color: white;
      transform: translateY(-1px);
    }

    .notification-status {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .unread-badge {
      background: #007bff;
      color: white;
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 0.65rem;
      font-weight: 700;
      white-space: nowrap;
    }

    .mark-read-btn {
      background: none;
      border: none;
      color: #666;
      cursor: pointer;
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 4px;
      transition: all 0.22s ease;
    }

    .mark-read-btn:hover {
      color: #007bff;
      background: #f0f4f8;
    }

    /* –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      background: #f8fbff;
      border-radius: 12px;
      border: 1.5px dashed #e8f4ff;
      margin-bottom: 30px;
    }

    .empty-icon {
      font-size: 3rem;
      margin-bottom: 15px;
      opacity: 0.7;
    }

    .empty-state h3 {
      color: #003366;
      margin-bottom: 10px;
      font-size: 1.1rem;
      font-weight: 700;
    }

    .empty-state p {
      color: #666;
      margin-bottom: 20px;
      font-size: 0.85rem;
      line-height: 1.4;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }

    /* –ü–∞–≥–∏–Ω–∞—Ü–∏—è */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    .pagination-btn {
      padding: 8px 12px;
      border-radius: 6px;
      background: #f8fbff;
      border: 1.5px solid #e8f4ff;
      color: #003366;
      font-weight: 600;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.22s ease;
      min-width: 36px;
      text-align: center;
    }

    .pagination-btn:hover:not(:disabled) {
      background: #e8f4ff;
      transform: translateY(-1px);
    }

    .pagination-btn.active {
      background: #007bff;
      color: white;
      border-color: #007bff;
    }

    .pagination-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-10px); }
      to { opacity: 1; transform: translateX(0); }
    }

    /* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–´–• */
    @media (max-width: 768px) {
      .notifications-page {
        padding: 15px 10px 30px;
      }

      .page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .page-title {
        font-size: 1.2rem;
      }

      .actions-container {
        width: 100%;
        justify-content: flex-start;
      }

      .notifications-filters {
        overflow-x: auto;
        padding-bottom: 10px;
        margin-bottom: 20px;
      }

      .filter-btn {
        flex-shrink: 0;
      }

      .notification-card {
        padding: 15px;
        flex-direction: column;
        gap: 12px;
      }

      .notification-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
      }

      .notification-time {
        align-self: flex-start;
      }

      .notification-actions {
        flex-wrap: wrap;
      }

      .notification-action-btn {
        flex: 1;
        min-width: 120px;
        text-align: center;
      }

      .empty-state {
        padding: 30px 15px;
      }

      .empty-icon {
        font-size: 2.5rem;
      }
    }

    @media (max-width: 480px) {
      .notifications-page {
        padding: 12px 8px 25px;
      }

      .page-title {
        font-size: 1.1rem;
      }

      .filter-btn,
      .mark-all-btn,
      .clear-all-btn {
        padding: 6px 12px;
        font-size: 0.75rem;
      }

      .notification-card {
        padding: 12px;
      }

      .notification-icon {
        width: 36px;
        height: 36px;
        font-size: 1rem;
      }

      .notification-title {
        font-size: 0.85rem;
      }

      .notification-message {
        font-size: 0.75rem;
      }

      .notification-action-btn {
        padding: 5px 10px;
        font-size: 0.7rem;
        min-width: 100px;
      }

      .empty-state {
        padding: 25px 12px;
      }

      .empty-icon {
        font-size: 2rem;
      }

      .empty-state h3 {
        font-size: 1rem;
      }

      .empty-state p {
        font-size: 0.8rem;
      }

      .pagination-btn {
        padding: 6px 10px;
        font-size: 0.75rem;
        min-width: 32px;
      }
    }

    /* –û—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–µ —ç–∫—Ä–∞–Ω—ã */
    @media (max-width: 360px) {
      .notification-actions {
        flex-direction: column;
        width: 100%;
      }

      .notification-action-btn {
        width: 100%;
      }

      .actions-container {
        flex-direction: column;
      }

      .mark-all-btn,
      .clear-all-btn {
        width: 100%;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <!-- –•–µ–¥–µ—Ä -->
  <header>
    <div class="logo">
      <a href="/">–ú–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</a>
    </div>

    <nav>
      {% if user.is_authenticated %}
        {% if user.role == 'teacher' or user.is_teacher %}
          <a href="{% url 'teacher_dashboard' %}" class="{% if request.path == '/teacher/dashboard/' %}active{% endif %}">–ì–ª–∞–≤–Ω–∞—è</a>
          <a href="{% url 'teacher_classes' %}" class="{% if 'classes' in request.path %}active{% endif %}">–ö–ª–∞—Å—Å—ã</a>
          <a href="{% url 'profile' user.username %}" class="{% if 'profile' in request.path %}active{% endif %}">–ü—Ä–æ—Ñ–∏–ª—å</a>
          <a href="{% url 'notifications' %}" class="{% if 'notifications' in request.path %}active{% endif %}">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a>
        {% else %}
          <a href="{% url 'dashboard' %}" class="{% if request.path == '/dashboard/' %}active{% endif %}">–ì–ª–∞–≤–Ω–∞—è</a>
          <a href="{% url 'dashboard' %}" class="{% if 'classes' in request.path %}active{% endif %}">–ú–æ–∏ –∫–ª–∞—Å—Å—ã</a>
          <a href="{% url 'profile' user.username %}" class="{% if 'profile' in request.path %}active{% endif %}">–ü—Ä–æ—Ñ–∏–ª—å</a>
          <a href="{% url 'notifications' %}" class="{% if 'notifications' in request.path %}active{% endif %}">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a>
        {% endif %}

        <div class="user-mini">
          <span>{{ user.get_full_name|default:user.username }}</span>
          <a href="{% url 'logout' %}" class="logout-btn">–í—ã–π—Ç–∏</a>
        </div>
      {% else %}
        <a href="{% url 'login' %}">–í–æ–π—Ç–∏</a>
        <a href="{% url 'register' %}" class="logout-btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
      {% endif %}
    </nav>
  </header>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <div class="main-content">
    <div class="notifications-page">
      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
      <div class="page-header">
        <h1 class="page-title">
          <span class="page-icon">üîî</span>
          –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
          {% if unread_count > 0 %}
            <span class="unread-badge">{{ unread_count }} –Ω–æ–≤—ã—Ö</span>
          {% endif %}
        </h1>
        
        <div class="actions-container">
          <button class="mark-all-btn" id="markAllReadBtn">–û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ</button>
          <button class="clear-all-btn" id="clearAllBtn">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
        </div>
      </div>

      <!-- –§–∏–ª—å—Ç—Ä—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
      <div class="notifications-filters">
        <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
        <button class="filter-btn" data-filter="unread">–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ</button>
        <button class="filter-btn" data-filter="invitations">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</button>
        <button class="filter-btn" data-filter="achievements">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
        <button class="filter-btn" data-filter="system">–°–∏—Å—Ç–µ–º–Ω—ã–µ</button>
      </div>

      <!-- –°–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
      <div class="notifications-list" id="notificationsList">
        {% if notifications %}
          {% for notification in notifications %}
          <div class="notification-card {% if not notification.is_read %}unread{% endif %}" 
               data-type="{{ notification.type }}" 
               data-id="{{ notification.id }}">
            <div class="notification-icon {{ notification.type }}">
              {% if notification.type == 'invitation' %}
                üì®
              {% elif notification.type == 'achievement' %}
                üèÜ
              {% elif notification.type == 'warning' %}
                ‚ö†Ô∏è
              {% else %}
                ‚ÑπÔ∏è
              {% endif %}
            </div>
            
            <div class="notification-content">
              <div class="notification-header">
                <h3 class="notification-title">{{ notification.title }}</h3>
                <div class="notification-status">
                  {% if not notification.is_read %}
                    <span class="unread-badge">–ù–æ–≤–æ–µ</span>
                  {% endif %}
                  <span class="notification-time">{{ notification.created_at|timesince }} –Ω–∞–∑–∞–¥</span>
                </div>
              </div>
              
              <p class="notification-message">{{ notification.message }}</p>
              
              <div class="notification-actions">
                {% if notification.type == 'invitation' and not notification.is_accepted %}
                  <button class="notification-action-btn primary" data-action="accept" data-id="{{ notification.id }}">
                    –ü—Ä–∏–Ω—è—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
                  </button>
                  <button class="notification-action-btn danger" data-action="decline" data-id="{{ notification.id }}">
                    –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                  </button>
                {% endif %}
                
                {% if notification.related_url %}
                  <a href="{{ notification.related_url }}" class="notification-action-btn secondary">
                    –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                  </a>
                {% endif %}
                
                {% if not notification.is_read %}
                  <button class="notification-action-btn secondary" data-action="mark-read" data-id="{{ notification.id }}">
                    –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
                  </button>
                {% endif %}
                
                <button class="notification-action-btn danger" data-action="delete" data-id="{{ notification.id }}">
                  –£–¥–∞–ª–∏—Ç—å
                </button>
              </div>
            </div>
          </div>
          {% endfor %}
        {% else %}
          <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
          <div class="empty-state">
            <div class="empty-icon">üì≠</div>
            <h3>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</h3>
            <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –≤–∞–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –≤ –∫–ª–∞—Å—Å—ã –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è—Ö</p>
          </div>
        {% endif %}
      </div>

      <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
      {% if notifications.has_other_pages %}
      <div class="pagination">
        {% if notifications.has_previous %}
          <button class="pagination-btn" onclick="window.location.href='?page={{ notifications.previous_page_number }}'">
            ‚Üê –ù–∞–∑–∞–¥
          </button>
        {% else %}
          <button class="pagination-btn" disabled>‚Üê –ù–∞–∑–∞–¥</button>
        {% endif %}
        
        {% for i in notifications.paginator.page_range %}
          {% if notifications.number == i %}
            <button class="pagination-btn active">{{ i }}</button>
          {% elif i > notifications.number|add:'-3' and i < notifications.number|add:'3' %}
            <button class="pagination-btn" onclick="window.location.href='?page={{ i }}'">{{ i }}</button>
          {% endif %}
        {% endfor %}
        
        {% if notifications.has_next %}
          <button class="pagination-btn" onclick="window.location.href='?page={{ notifications.next_page_number }}'">
            –í–ø–µ—Ä–µ–¥ ‚Üí
          </button>
        {% else %}
          <button class="pagination-btn" disabled>–í–ø–µ—Ä–µ–¥ ‚Üí</button>
        {% endif %}
      </div>
      {% endif %}
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const notificationsList = document.getElementById('notificationsList');
    const filterButtons = document.querySelectorAll('.filter-btn');
    const markAllReadBtn = document.getElementById('markAllReadBtn');
    const clearAllBtn = document.getElementById('clearAllBtn');
    const notificationCards = document.querySelectorAll('.notification-card');

    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    filterButtons.forEach(button => {
      button.addEventListener('click', function() {
        const filter = this.dataset.filter;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä
        filterButtons.forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        notificationCards.forEach(card => {
          if (filter === 'all') {
            card.style.display = 'flex';
          } else if (filter === 'unread') {
            card.style.display = card.classList.contains('unread') ? 'flex' : 'none';
          } else {
            card.style.display = card.dataset.type === filter ? 'flex' : 'none';
          }
        });
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        const visibleCards = Array.from(notificationCards).filter(card => 
          card.style.display !== 'none'
        );
        
        if (visibleCards.length === 0 && notificationsList.querySelector('.empty-state') === null) {
          showEmptyState(filter);
        } else if (visibleCards.length > 0) {
          removeEmptyState();
        }
      });
    });

    // –î–µ–π—Å—Ç–≤–∏—è —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
    notificationsList.addEventListener('click', function(e) {
      const actionBtn = e.target.closest('.notification-action-btn');
      if (!actionBtn) return;
      
      e.preventDefault();
      const action = actionBtn.dataset.action;
      const notificationId = actionBtn.dataset.id;
      const notificationCard = actionBtn.closest('.notification-card');
      
      switch(action) {
        case 'accept':
          acceptInvitation(notificationId, notificationCard);
          break;
        case 'decline':
          declineInvitation(notificationId, notificationCard);
          break;
        case 'mark-read':
          markAsRead(notificationId, notificationCard);
          break;
        case 'delete':
          deleteNotification(notificationId, notificationCard);
          break;
      }
    });

    // –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
    markAllReadBtn.addEventListener('click', function() {
      if (!confirm('–û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ?')) return;
      
      fetch('/api/notifications/mark-all-read/', {
        method: 'POST',
        headers: {
          'X-CSRFToken': getCookie('csrftoken'),
          'Content-Type': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          notificationCards.forEach(card => {
            card.classList.remove('unread');
            const unreadBadge = card.querySelector('.unread-badge');
            if (unreadBadge) unreadBadge.remove();
            
            const markReadBtn = card.querySelector('[data-action="mark-read"]');
            if (markReadBtn) markReadBtn.remove();
          });
          
          // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
          const unreadBadge = document.querySelector('.page-title .unread-badge');
          if (unreadBadge) unreadBadge.remove();
          
          showToast('–í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ', 'success');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π', 'error');
      });
    });

    // –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    clearAllBtn.addEventListener('click', function() {
      if (!confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;
      
      fetch('/api/notifications/clear-all/', {
        method: 'POST',
        headers: {
          'X-CSRFToken': getCookie('csrftoken'),
          'Content-Type': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          notificationsList.innerHTML = '';
          showEmptyState('all');
          showToast('–í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã', 'success');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π', 'error');
      });
    });

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function acceptInvitation(notificationId, card) {
      fetch(`/api/notifications/${notificationId}/accept/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': getCookie('csrftoken'),
          'Content-Type': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          card.style.opacity = '0.5';
          card.style.pointerEvents = 'none';
          
          const actionsDiv = card.querySelector('.notification-actions');
          actionsDiv.innerHTML = `
            <button class="notification-action-btn secondary" disabled>
              ‚úÖ –ü—Ä–∏–Ω—è—Ç–æ
            </button>
          `;
          
          showToast('–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ', 'success');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è', 'error');
      });
    }

    function declineInvitation(notificationId, card) {
      fetch(`/api/notifications/${notificationId}/decline/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': getCookie('csrftoken'),
          'Content-Type': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          card.style.opacity = '0.5';
          card.style.pointerEvents = 'none';
          
          const actionsDiv = card.querySelector('.notification-actions');
          actionsDiv.innerHTML = `
            <button class="notification-action-btn secondary" disabled>
              ‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ
            </button>
          `;
          
          showToast('–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ', 'success');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è', 'error');
      });
    }

    function markAsRead(notificationId, card) {
      fetch(`/api/notifications/${notificationId}/mark-read/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': getCookie('csrftoken'),
          'Content-Type': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          card.classList.remove('unread');
          const unreadBadge = card.querySelector('.unread-badge');
          if (unreadBadge) unreadBadge.remove();
          
          const markReadBtn = card.querySelector('[data-action="mark-read"]');
          if (markReadBtn) markReadBtn.remove();
          
          // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
          updateUnreadCount();
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è', 'error');
      });
    }

    function deleteNotification(notificationId, card) {
      if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ?')) return;
      
      fetch(`/api/notifications/${notificationId}/delete/`, {
        method: 'DELETE',
        headers: {
          'X-CSRFToken': getCookie('csrftoken'),
          'Content-Type': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          card.style.animation = 'slideOut 0.3s ease forwards';
          setTimeout(() => {
            card.remove();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Å—Ç–∞–ª–∏—Å—å –ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const remainingCards = document.querySelectorAll('.notification-card');
            if (remainingCards.length === 0) {
              showEmptyState('all');
            }
          }, 300);
          
          showToast('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'success');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è', 'error');
      });
    }

    function showEmptyState(filter) {
      const emptyState = document.createElement('div');
      emptyState.className = 'empty-state';
      
      let message = '';
      let icon = 'üì≠';
      
      switch(filter) {
        case 'unread':
          message = '–ù–µ—Ç –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π';
          icon = '‚úÖ';
          break;
        case 'invitations':
          message = '–ù–µ—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π';
          icon = 'üì®';
          break;
        case 'achievements':
          message = '–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è—Ö';
          icon = 'üèÜ';
          break;
        case 'system':
          message = '–ù–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π';
          icon = '‚öôÔ∏è';
          break;
        default:
          message = '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç';
          icon = 'üì≠';
      }
      
      emptyState.innerHTML = `
        <div class="empty-icon">${icon}</div>
        <h3>${message}</h3>
        <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –≤–∞–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</p>
      `;
      
      notificationsList.appendChild(emptyState);
    }

    function removeEmptyState() {
      const emptyState = notificationsList.querySelector('.empty-state');
      if (emptyState) {
        emptyState.remove();
      }
    }

    function updateUnreadCount() {
      const unreadCards = document.querySelectorAll('.notification-card.unread');
      const unreadBadge = document.querySelector('.page-title .unread-badge');
      
      if (unreadCards.length === 0 && unreadBadge) {
        unreadBadge.remove();
      } else if (unreadCards.length > 0) {
        if (!unreadBadge) {
          const badge = document.createElement('span');
          badge.className = 'unread-badge';
          badge.textContent = `${unreadCards.length} –Ω–æ–≤—ã—Ö`;
          document.querySelector('.page-title').appendChild(badge);
        } else {
          unreadBadge.textContent = `${unreadCards.length} –Ω–æ–≤—ã—Ö`;
        }
      }
    }

    function showToast(message, type) {
      // –°–æ–∑–¥–∞–µ–º —Ç–æ—Å—Ç
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.textContent = message;
      toast.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 8px;
        color: white;
        font-weight: 600;
        z-index: 10000;
        animation: slideInRight 0.3s ease;
      `;
      
      if (type === 'success') {
        toast.style.background = '#28a745';
      } else {
        toast.style.background = '#dc3545';
      }
      
      document.body.appendChild(toast);
      
      // –£–¥–∞–ª—è–µ–º —Ç–æ—Å—Ç —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
      setTimeout(() => {
        toast.style.animation = 'slideOutRight 0.3s ease forwards';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }

    // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideOut {
        from { opacity: 1; transform: translateX(0); }
        to { opacity: 0; transform: translateX(-100px); }
      }
      
      @keyframes slideInRight {
        from { transform: translateX(100px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      
      @keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100px); opacity: 0; }
      }
    `;
    document.head.appendChild(style);
  });
  </script>
</body>
</html>