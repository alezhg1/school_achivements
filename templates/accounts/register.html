{% extends 'base.html' %}
{% block title %}–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –ì–ë–û–£ 444{% endblock %}

{% block content %}
<div class="auth-page">
  <div class="auth-card">
    <h2>–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</h2>
    <p class="subtitle">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –ì–ë–û–£ 444 üöÄ</p>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —à–∫–æ–ª–µ -->
    <div class="school-banner">
      <div class="school-icon">üè´</div>
      <div class="school-info">
        <h3>–ì–ë–û–£ 444</h3>
        <p>–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —É—á–µ–Ω–∏–∫–æ–≤ –∏ —É—á–∏—Ç–µ–ª–µ–π</p>
      </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π -->
    <div class="teacher-notice hidden" id="teacherNotice">
      <div class="notice-icon">‚è≥</div>
      <div class="notice-text">
        <strong>–í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π:</strong>
        <p>–î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —É—á–∏—Ç–µ–ª–µ–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —à–∫–æ–ª—å–Ω—É—é –ø–æ—á—Ç—É —Å –¥–æ–º–µ–Ω–æ–º <strong>@schmos444.ru</strong>.
           –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–∞—à–∞ –∑–∞—è–≤–∫–∞ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É.
           –í—ã –ø–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç –±—É–¥–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω.</p>
      </div>
    </div>

    <form method="post" class="auth-form" id="registerForm" novalidate>
      {% csrf_token %}

      <!-- –í—ã–≤–æ–¥ –æ–±—â–∏—Ö –æ—à–∏–±–æ–∫ -->
      {% if form.non_field_errors %}
        <div class="alert alert-error">
          {% for error in form.non_field_errors %}
            {{ error }}
          {% endfor %}
        </div>
      {% endif %}

      <!-- –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
      <div class="form-group">
        <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å *</label>
        <div class="role-switch">
          <label class="role-option {% if form.role.value == 'student' or not form.role.value %}active{% endif %}">
            <input type="radio" name="role" value="student" {% if form.role.value == 'student' or not form.role.value %}checked{% endif %}>
            <span class="role-content">
              <span class="role-icon">üë®‚Äçüéì</span>
              <span class="role-text">–£—á–µ–Ω–∏–∫</span>
            </span>
          </label>
          <label class="role-option {% if form.role.value == 'teacher' %}active{% endif %}">
            <input type="radio" name="role" value="teacher" {% if form.role.value == 'teacher' %}checked{% endif %}>
            <span class="role-content">
              <span class="role-icon">üë®‚Äçüè´</span>
              <span class="role-text">–£—á–∏—Ç–µ–ª—å</span>
            </span>
          </label>
        </div>
        {% if form.role.errors %}
          <div class="field-errors">
            {% for error in form.role.errors %}
              <span class="error">{{ error }}</span>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è -->
      <div class="form-group">
        <label for="id_username">–õ–æ–≥–∏–Ω *</label>
        <input type="text" name="username" id="id_username" value="{{ form.username.value|default:'' }}" class="{% if form.username.errors %}error-field{% endif %}" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω" required>
        {% if form.username.errors %}
          <div class="field-errors">
            {% for error in form.username.errors %}
              <span class="error">{{ error }}</span>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="id_first_name">–ò–º—è</label>
          <input type="text" name="first_name" id="id_first_name" value="{{ form.first_name.value|default:'' }}" placeholder="–í–∞—à–µ –∏–º—è">
        </div>
        <div class="form-group">
          <label for="id_last_name">–§–∞–º–∏–ª–∏—è</label>
          <input type="text" name="last_name" id="id_last_name" value="{{ form.last_name.value|default:'' }}" placeholder="–í–∞—à–∞ —Ñ–∞–º–∏–ª–∏—è">
        </div>
      </div>

      <div class="form-group">
        <label for="id_email">Email *</label>
        <input type="email" name="email" id="id_email" value="{{ form.email.value|default:'' }}" class="{% if form.email.errors %}error-field{% endif %}" placeholder="your@email.com" required>
        {% if form.email.errors %}
          <div class="field-errors">
            {% for error in form.email.errors %}
              <span class="error">{{ error }}</span>
            {% endfor %}
          </div>
        {% endif %}
        <div class="email-hint hidden" id="teacherEmailHint">
          <small style="color: #007bff;">–î–ª—è —É—á–∏—Ç–µ–ª–µ–π: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ—á—Ç—É @schmos444.ru</small>
        </div>
      </div>

      <!-- –ü–æ–ª—è –∫–ª–∞—Å—Å–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è —É—á–µ–Ω–∏–∫–æ–≤) -->
      <div class="form-row student-fields {% if form.role.value == 'teacher' %}hidden{% endif %}" id="studentFields">
        <div class="form-group">
          <label for="id_class_number">–ö–ª–∞—Å—Å *</label>
          <input type="text" name="class_number" id="id_class_number" value="{{ form.class_number.value|default:'' }}" placeholder="–ù–æ–º–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä: 5)" required>
        </div>
        <div class="form-group">
          <label for="id_class_letter">–ë—É–∫–≤–∞ *</label>
          <input type="text" name="class_letter" id="id_class_letter" value="{{ form.class_letter.value|default:'' }}" placeholder="–ë—É–∫–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ê)" required>
        </div>
      </div>

      <!-- –ü–æ–ª—è –∫–ª–∞—Å—Å–∞ (–¥–ª—è —É—á–∏—Ç–µ–ª–µ–π - –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ) -->
      <div class="form-row teacher-fields hidden" id="teacherFields">
        <div class="form-group">
          <label for="id_teacher_class_number">–ö–ª–∞—Å—Å (–µ—Å–ª–∏ –µ—Å—Ç—å)</label>
          <input type="text" name="class_number" id="id_teacher_class_number" value="{{ form.class_number.value|default:'' }}" placeholder="–ù–æ–º–µ—Ä (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
        </div>
        <div class="form-group">
          <label for="id_teacher_class_letter">–ë—É–∫–≤–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)</label>
          <input type="text" name="class_letter" id="id_teacher_class_letter" value="{{ form.class_letter.value|default:'' }}" placeholder="–ë—É–∫–≤–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
        </div>
      </div>

      <!-- –ü–∞—Ä–æ–ª–∏ -->
      <div class="form-row">
        <div class="form-group">
          <label for="id_password1">–ü–∞—Ä–æ–ª—å *</label>
          <input type="password" name="password1" id="id_password1" class="{% if form.password1.errors %}error-field{% endif %}" placeholder="–ù–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤" required>
          {% if form.password1.errors %}
            <div class="field-errors">
              {% for error in form.password1.errors %}
                <span class="error">{{ error }}</span>
              {% endfor %}
            </div>
          {% endif %}
        </div>
        <div class="form-group">
          <label for="id_password2">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è *</label>
          <input type="password" name="password2" id="id_password2" class="{% if form.password2.errors %}error-field{% endif %}" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
          {% if form.password2.errors %}
            <div class="field-errors">
              {% for error in form.password2.errors %}
                <span class="error">{{ error }}</span>
              {% endfor %}
            </div>
          {% endif %}
        </div>
      </div>

      <!-- –°–æ–≥–ª–∞—à–µ–Ω–∏–µ -->
      <div class="form-group checkbox-group">
        <input type="checkbox" name="accept_policy" id="id_accept_policy" {% if form.accept_policy.value %}checked{% endif %} required>
        <label for="id_accept_policy" class="checkbox-label">
          –°–æ–≥–ª–∞—Å–µ–Ω —Å <a href="/accounts/policy/" target="_blank" style="color: #007bff; text-decoration: none; font-weight: 600;">–ø–æ–ª–∏—Ç–∏–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</a> *
        </label>
        {% if form.accept_policy.errors %}
          <div class="field-errors">
            {% for error in form.accept_policy.errors %}
              <span class="error">{{ error }}</span>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <button type="submit" class="btn-primary" id="submitBtn">
        <span class="btn-text">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</span>
        <span class="btn-loading" style="display: none;">‚è≥ –°–æ–∑–¥–∞–µ–º –∞–∫–∫–∞—É–Ω—Ç...</span>
      </button>

      <div class="auth-footer">
        –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="{% url 'login' %}">–í–æ–π—Ç–∏</a>
      </div>
    </form>
  </div>
</div>

<style>
body {
  background: linear-gradient(180deg, #eaf4ff 0%, #dbeeff 100%);
  margin: 0;
  padding: 0;
}

.auth-page {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  padding: 20px;
}

.auth-card {
  background: white;
  padding: 40px;
  border-radius: 20px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.1);
  width: 100%;
  max-width: 500px;
  animation: fadeIn 0.5s ease;
}

.auth-card h2 {
  text-align: center;
  color: #003366;
  margin-bottom: 8px;
  font-size: 1.8rem;
}

.subtitle {
  text-align: center;
  color: #567;
  margin-bottom: 25px;
  font-size: 1rem;
}

/* –ë–∞–Ω–Ω–µ—Ä —à–∫–æ–ª—ã */
.school-banner {
  background: linear-gradient(135deg, #007bff, #0056b3);
  color: white;
  padding: 20px;
  border-radius: 15px;
  margin-bottom: 25px;
  display: flex;
  align-items: center;
  gap: 15px;
  text-align: left;
}

.school-icon {
  font-size: 2.5rem;
  flex-shrink: 0;
}

.school-info h3 {
  margin: 0 0 5px 0;
  font-size: 1.3rem;
}

.school-info p {
  margin: 0;
  opacity: 0.9;
  font-size: 0.9rem;
}

/* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π */
.teacher-notice {
  background: #fff3cd;
  border: 1px solid #ffeaa7;
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 20px;
  display: flex;
  align-items: flex-start;
  gap: 12px;
}

.teacher-notice.hidden {
  display: none;
}

.notice-icon {
  font-size: 1.2rem;
  flex-shrink: 0;
}

.notice-text {
  flex: 1;
}

.notice-text strong {
  color: #856404;
}

.notice-text p {
  margin: 5px 0 0 0;
  color: #856404;
  font-size: 0.9rem;
  line-height: 1.4;
}

.auth-form {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.form-label {
  font-weight: 600;
  color: #003366;
  margin-bottom: 8px;
  display: block;
}

/* –†–æ–ª–∏ */
.role-switch {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
}

.role-option {
  flex: 1;
  position: relative;
  cursor: pointer;
}

.role-option input[type="radio"] {
  position: absolute;
  opacity: 0;
  width: 0;
  height: 0;
}

.role-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  padding: 20px 15px;
  border: 2px solid #e8f4ff;
  border-radius: 12px;
  background: white;
  transition: all 0.3s ease;
  text-align: center;
}

.role-option input[type="radio"]:checked + .role-content,
.role-option.active .role-content {
  background: #007bff;
  color: white;
  border-color: #007bff;
  box-shadow: 0 4px 12px rgba(0,123,255,0.3);
  transform: translateY(-2px);
}

.role-option:hover .role-content {
  border-color: #007bff;
  transform: translateY(-2px);
}

.role-icon {
  font-size: 1.5rem;
}

.role-text {
  font-weight: 600;
  font-size: 0.9rem;
}

/* –ì—Ä—É–ø–ø—ã —Ñ–æ—Ä–º */
.form-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.form-row {
  display: flex;
  gap: 15px;
}

.form-row .form-group {
  flex: 1;
}

/* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
.auth-form input:not([type="checkbox"]),
.auth-form select {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #e8f4ff;
  border-radius: 10px;
  background: #f9fcff;
  font-size: 15px;
  transition: all 0.3s ease;
  font-family: inherit;
}

.auth-form input:focus,
.auth-form select:focus {
  border-color: #007bff;
  box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
  outline: none;
  background: white;
}

.error-field {
  border-color: #dc3545 !important;
}

.email-hint {
  margin-top: 5px;
}

.email-hint small {
  font-size: 12px;
}

/* –ß–µ–∫–±–æ–∫—Å */
.checkbox-group {
  flex-direction: row;
  align-items: flex-start;
  gap: 12px;
  margin-top: 10px;
}

.auth-form input[type="checkbox"] {
  width: 18px;
  height: 18px;
  margin-top: 2px;
}

.checkbox-label {
  font-size: 14px;
  color: #333;
  line-height: 1.4;
  cursor: pointer;
}

.checkbox-label a {
  color: #007bff;
  text-decoration: none;
}

.checkbox-label a:hover {
  text-decoration: underline;
}

/* –ö–Ω–æ–ø–∫–∞ */
.btn-primary {
  background: linear-gradient(135deg, #007bff, #0047b3);
  color: white;
  border: none;
  padding: 14px;
  font-weight: 600;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 16px;
  margin-top: 10px;
}

.btn-primary:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0,123,255,0.3);
}

.btn-primary:disabled {
  opacity: 0.7;
  cursor: not-allowed;
  transform: none;
}

/* –û—à–∏–±–∫–∏ */
.alert {
  padding: 12px 16px;
  border-radius: 8px;
  margin-bottom: 20px;
}

.alert-error {
  background: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}

.field-errors {
  margin-top: 5px;
}

.error {
  color: #dc3545;
  font-size: 12px;
  display: block;
}

/* –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è */
.hidden {
  display: none !important;
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
  .auth-card {
    padding: 30px 25px;
  }

  .form-row {
    flex-direction: column;
    gap: 0;
  }

  .role-switch {
    flex-direction: column;
  }

  .school-banner {
    flex-direction: column;
    text-align: center;
    gap: 10px;
  }

  .teacher-notice {
    flex-direction: column;
    text-align: center;
    gap: 10px;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('registerForm');
  const submitBtn = document.getElementById('submitBtn');
  const roleOptions = document.querySelectorAll('.role-option');
  const studentFields = document.getElementById('studentFields');
  const teacherFields = document.getElementById('teacherFields');
  const teacherNotice = document.getElementById('teacherNotice');
  const teacherEmailHint = document.getElementById('teacherEmailHint');
  const emailInput = document.getElementById('id_email');
  const studentClassNumber = document.getElementById('id_class_number');
  const studentClassLetter = document.getElementById('id_class_letter');

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π
  roleOptions.forEach(option => {
    const radio = option.querySelector('input[type="radio"]');

    radio.addEventListener('change', function() {
      // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å
      roleOptions.forEach(opt => opt.classList.remove('active'));
      option.classList.add('active');

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª—è –∫–ª–∞—Å—Å–∞
      if (this.value === 'student') {
        studentFields.classList.remove('hidden');
        teacherFields.classList.add('hidden');
        teacherNotice.classList.add('hidden');
        teacherEmailHint.classList.add('hidden');

        // –î–µ–ª–∞–µ–º –ø–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –¥–ª—è —É—á–µ–Ω–∏–∫–æ–≤
        studentClassNumber.required = true;
        studentClassLetter.required = true;

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É email
        emailInput.placeholder = "your@email.com";
      } else {
        studentFields.classList.add('hidden');
        teacherFields.classList.remove('hidden');
        teacherNotice.classList.remove('hidden');
        teacherEmailHint.classList.remove('hidden');

        // –î–µ–ª–∞–µ–º –ø–æ–ª—è –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π
        studentClassNumber.required = false;
        studentClassLetter.required = false;

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É email –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π
        emailInput.placeholder = "your@schmos444.ru";
      }
    });

    // –¢–∞–∫–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–ª–∏–∫ –ø–æ –≤—Å–µ–π –∫–∞—Ä—Ç–æ—á–∫–µ
    option.addEventListener('click', function(e) {
      if (e.target.type !== 'radio') {
        radio.checked = true;
        radio.dispatchEvent(new Event('change'));
      }
    });
  });

  // –í–∞–ª–∏–¥–∞—Ü–∏—è email –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
  emailInput.addEventListener('blur', function() {
    const selectedRole = form.querySelector('input[name="role"]:checked');
    if (selectedRole && selectedRole.value === 'teacher') {
      const email = this.value.trim();
      if (email && !email.endsWith('@schmos444.ru')) {
        this.classList.add('error-field');
        // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        let errorDiv = this.parentElement.querySelector('.email-error');
        if (!errorDiv) {
          errorDiv = document.createElement('div');
          errorDiv.className = 'field-errors email-error';
          this.parentElement.appendChild(errorDiv);
        }
        errorDiv.innerHTML = '<span class="error">–î–ª—è —É—á–∏—Ç–µ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —à–∫–æ–ª—å–Ω—ã–π –¥–æ–º–µ–Ω @schmos444.ru</span>';
      } else {
        this.classList.remove('error-field');
        const errorDiv = this.parentElement.querySelector('.email-error');
        if (errorDiv) {
          errorDiv.remove();
        }
      }
    }
  });

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
  form.addEventListener('submit', function(e) {
    const btnText = submitBtn.querySelector('.btn-text');
    const btnLoading = submitBtn.querySelector('.btn-loading');

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    btnText.style.display = 'none';
    btnLoading.style.display = 'inline';
    submitBtn.disabled = true;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—ã–±—Ä–∞–Ω–∞ —Ä–æ–ª—å
    const selectedRole = form.querySelector('input[name="role"]:checked');
    if (!selectedRole) {
      e.preventDefault();
      btnText.style.display = 'inline';
      btnLoading.style.display = 'none';
      submitBtn.disabled = false;
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å (–£—á–µ–Ω–∏–∫ –∏–ª–∏ –£—á–∏—Ç–µ–ª—å)');
      return;
    }

    // –î–ª—è —É—á–∏—Ç–µ–ª–µ–π –ø—Ä–æ–≤–µ—Ä—è–µ–º email
    if (selectedRole.value === 'teacher') {
      const email = emailInput.value.trim();
      if (!email.endsWith('@schmos444.ru')) {
        e.preventDefault();
        btnText.style.display = 'inline';
        btnLoading.style.display = 'none';
        submitBtn.disabled = false;
        alert('–î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —É—á–∏—Ç–µ–ª–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à–∫–æ–ª—å–Ω—ã–π email —Å –¥–æ–º–µ–Ω–æ–º @schmos444.ru');
        emailInput.focus();
        return;
      }
    }

    // –î–ª—è —É—á–µ–Ω–∏–∫–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∫–ª–∞—Å—Å–∞
    if (selectedRole.value === 'student') {
      if (!studentClassNumber.value.trim() || !studentClassLetter.value.trim()) {
        e.preventDefault();
        btnText.style.display = 'inline';
        btnLoading.style.display = 'none';
        submitBtn.disabled = false;
        alert('–î–ª—è —É—á–µ–Ω–∏–∫–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –Ω–æ–º–µ—Ä –∏ –±—É–∫–≤—É –∫–ª–∞—Å—Å–∞');
        return;
      }
    }

    // –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
    const requiredFields = form.querySelectorAll('[required]');
    let isValid = true;
    let firstErrorField = null;

    requiredFields.forEach(field => {
      if (!field.value.trim() && field.type !== 'radio' && field.type !== 'checkbox') {
        isValid = false;
        field.classList.add('error-field');
        if (!firstErrorField) firstErrorField = field;
      } else if (field.type === 'checkbox' && !field.checked) {
        isValid = false;
        field.parentElement.style.color = '#dc3545';
      } else {
        field.classList.remove('error-field');
        if (field.type === 'checkbox') {
          field.parentElement.style.color = '';
        }
      }
    });

    if (!isValid) {
      e.preventDefault();
      btnText.style.display = 'inline';
      btnLoading.style.display = 'none';
      submitBtn.disabled = false;

      if (firstErrorField) {
        firstErrorField.focus();
      }

      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è.');
    }
  });

  // –°–Ω–∏–º–∞–µ–º –æ—à–∏–±–∫—É –ø—Ä–∏ –≤–≤–æ–¥–µ
  const inputs = form.querySelectorAll('input');
  inputs.forEach(input => {
    input.addEventListener('input', function() {
      if (this.value.trim()) {
        this.classList.remove('error-field');

        // –£–±–∏—Ä–∞–µ–º –æ—à–∏–±–∫–∏ email –ø—Ä–∏ –≤–≤–æ–¥–µ
        if (this.type === 'email') {
          const errorDiv = this.parentElement.querySelector('.email-error');
          if (errorDiv) {
            errorDiv.remove();
          }
        }
      }
    });

    input.addEventListener('change', function() {
      if (this.type === 'checkbox' && this.checked) {
        this.parentElement.style.color = '';
      }
    });
  });

  // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–µ –ø–æ–ª–µ
  const firstInput = form.querySelector('input:not([type="radio"]):not([type="checkbox"]):not([type="hidden"])');
  if (firstInput) {
    firstInput.focus();
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  const initialRole = form.querySelector('input[name="role"]:checked');
  if (initialRole && initialRole.value === 'teacher') {
    teacherNotice.classList.remove('hidden');
    teacherEmailHint.classList.remove('hidden');
    emailInput.placeholder = "your@schmos444.ru";
  }
});
</script>
{% endblock %}