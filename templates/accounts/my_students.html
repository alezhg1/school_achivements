{% extends 'base.html' %}
{% block title %}–ú–æ–∏ —É—á–µ–Ω–∏–∫–∏{% endblock %}
{% block content %}
<div class="teacher-students-page">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="page-hero">
    <div class="hero-content">
      <h1>–ú–æ–∏ —É—á–µ–Ω–∏–∫–∏ üë®‚Äçüéì</h1>
      <p>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–º–∏ —É—á–µ–Ω–∏–∫–∞–º–∏ –∏ –∏—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è–º–∏</p>
    </div>
    <div class="hero-stats">
      <div class="stat-card">
        <div class="stat-icon">üë•</div>
        <div class="stat-info">
          <span class="stat-number">{{ accepted_students.count }}</span>
          <span class="stat-label">–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üì®</div>
        <div class="stat-info">
          <span class="stat-number">{{ pending_invitations.count }}</span>
          <span class="stat-label">–û–∂–∏–¥–∞—é—Ç</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">‚è≥</div>
        <div class="stat-info">
          <span class="stat-number">{{ pending_achievements.count }}</span>
          <span class="stat-label">–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</span>
        </div>
      </div>
    </div>
  </div>

  <!-- –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –Ω–æ–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞ -->
  <div class="invite-section">
    <div class="section-header">
      <h2>–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –Ω–æ–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞</h2>
    </div>
    <form method="post" class="invite-form">
      {% csrf_token %}
      <div class="form-group">
        <label for="userSearch">–ü–æ–∏—Å–∫ —É—á–µ–Ω–∏–∫–∞</label>
        <div class="search-container">
          <input type="text" id="userSearch" class="search-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è, —Ñ–∞–º–∏–ª–∏—é –∏–ª–∏ –ª–æ–≥–∏–Ω —É—á–µ–Ω–∏–∫–∞...">
          <div class="search-icon">üîç</div>
          <div class="search-results" id="searchResults"></div>
        </div>
        {{ form.student }}
      </div>
      <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</button>
    </form>
  </div>

  <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ -->
  {% if pending_achievements %}
  <div class="moderation-section">
    <div class="section-header">
      <h2>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ ‚è≥</h2>
    </div>
    <div class="achievements-grid">
      {% for achievement in pending_achievements %}
      <div class="achievement-card pending">
        <div class="achievement-header">
          <h3>{{ achievement.title }}</h3>
          <span class="status-badge pending">–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</span>
        </div>
        <p class="student-info">–£—á–µ–Ω–∏–∫: {{ achievement.student.get_full_name }}</p>
        <p class="achievement-description">{{ achievement.description|truncatechars:100 }}</p>
        <div class="achievement-meta">
          <span class="meta-item">{{ achievement.result }}</span>
          <span class="meta-item">{{ achievement.year }}</span>
        </div>
        <div class="achievement-actions">
          <a href="{% url 'moderate_achievement' achievement.id %}" class="btn btn-primary">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</a>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —É—á–µ–Ω–∏–∫–∏ -->
  <div class="students-section">
    <div class="section-header">
      <h2>–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —É—á–µ–Ω–∏–∫–∏ üë•</h2>
    </div>

    {% if accepted_students %}
    <div class="students-grid">
      {% for relationship in accepted_students %}
      <div class="student-card">
        <div class="student-avatar">
          {{ relationship.student.first_name|slice:":1" }}{{ relationship.student.last_name|slice:":1" }}
        </div>
        <div class="student-info">
          <h3>{{ relationship.student.get_full_name }}</h3>
          <p class="username">@{{ relationship.student.username }}</p>
          <div class="student-stats">
            <span class="stat">
              <strong>{{ relationship.student.achievements.count }}</strong>
              <span>–¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</span>
            </span>
            <span class="stat">
              <strong>{{ relationship.student.achievements.approved.count }}</strong>
              <span>–æ–¥–æ–±—Ä–µ–Ω–æ</span>
            </span>
          </div>
        </div>
        <div class="student-actions">
          <a href="{% url 'profile' relationship.student.username %}" class="btn btn-outline">–ü—Ä–æ—Ñ–∏–ª—å</a>
          <a href="{% url 'add_achievement_for' relationship.student.id %}" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ</a>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
      <div class="empty-icon">üë•</div>
      <h3>–ü–æ–∫–∞ –Ω–µ—Ç –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã—Ö —É—á–µ–Ω–∏–∫–æ–≤</h3>
      <p>–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ —É—á–µ–Ω–∏–∫–æ–≤, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –∏—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è–º–∏</p>
    </div>
    {% endif %}
  </div>

  <!-- –û–∂–∏–¥–∞—é—â–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
  {% if pending_invitations %}
  <div class="pending-section">
    <div class="section-header">
      <h2>–û–∂–∏–¥–∞—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è üì®</h2>
    </div>
    <div class="invitations-list">
      {% for invitation in pending_invitations %}
      <div class="invitation-card">
        <div class="invitation-content">
          <div class="student-avatar small">
            {{ invitation.student.first_name|slice:":1" }}{{ invitation.student.last_name|slice:":1" }}
          </div>
          <div class="invitation-info">
            <h4>{{ invitation.student.get_full_name }}</h4>
            <p>@{{ invitation.student.username }}</p>
            <span class="invitation-date">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {{ invitation.created_at|date:"d.m.Y" }}</span>
          </div>
        </div>
        <div class="invitation-status">
          <span class="status pending">–û–∂–∏–¥–∞–µ—Ç –æ—Ç–≤–µ—Ç–∞</span>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}
</div>

<style>
.teacher-students-page {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  animation: fadeIn 0.6s ease;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã - –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ class_detail.html */
/* –î–æ–±–∞–≤—å—Ç–µ –∫—Ä–∞—Å–∏–≤—ã–µ —Å—Ç–∏–ª–∏ —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏ */
</style>

<script>
// JavaScript –¥–ª—è –ø–æ–∏—Å–∫–∞ —É—á–µ–Ω–∏–∫–æ–≤ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π send_invite.html)
</script>
{% endblock %}