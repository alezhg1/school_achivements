<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü—Ä–æ—Ñ–∏–ª—å ‚Äî {{ profile_user.get_full_name|default:profile_user.username }}</title>
  <style>
    /* –°–ë–†–û–° –°–¢–ò–õ–ï–ô */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      background: white;
      font-family: "Segoe UI", Roboto, -apple-system, BlinkMacSystemFont, Arial, sans-serif;
      font-size: 13px;
      line-height: 1.3;
    }

    /* HEADER */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(90deg, #0077e6 0%, #005bb5 100%);
      color: #fff;
      z-index: 1200;
      box-shadow: 0 3px 8px rgba(3, 36, 74, 0.12);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 12px;
      width: 100%;
      height: 55px;
    }

    .logo a {
      font-weight: 700;
      font-size: 1rem;
      color: #fff;
      text-decoration: none;
      white-space: nowrap;
    }

    nav {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: flex-end;
      flex: 1;
    }

    nav a {
      color: rgba(255, 255, 255, 0.95);
      text-decoration: none;
      padding: 5px 7px;
      border-radius: 5px;
      font-weight: 600;
      transition: all 0.22s;
      font-size: 0.8rem;
      white-space: nowrap;
    }

    nav a:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: translateY(-1px);
    }

    .logout-btn {
      background: rgba(220, 53, 69, 0.9);
      color: white;
      padding: 5px 8px;
      border-radius: 5px;
      text-decoration: none;
      font-weight: 600;
      font-size: 0.75rem;
      border: none;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.3s ease;
      margin-left: 5px;
    }

    .logout-btn:hover {
      background: #dc3545;
      transform: translateY(-1px);
    }

    /* –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ */
    .main-content {
      padding-top: 55px;
      min-height: 100vh;
      background: white;
    }

    .profile-page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 20px 15px 40px;
      animation: fadeIn 0.6s ease;
      background: white;
    }

    /* ====== –ü—Ä–æ—Ñ–∏–ª—å ====== */
    .profile-card {
      background: white;
      border-radius: 14px;
      box-shadow: 0 6px 20px rgba(0, 87, 174, 0.12);
      border: 1px solid #cde0ff;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-bottom: 25px;
    }

    .profile-header {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .profile-avatar {
      background: linear-gradient(135deg, #007bff, #0047b3);
      color: white;
      width: 70px;
      height: 70px;
      border-radius: 16px;
      font-size: 24px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .profile-info {
      flex: 1;
      min-width: 0;
    }

    .profile-info h1 {
      margin: 0 0 8px 0;
      font-size: 1.4rem;
      color: #002b5c;
      line-height: 1.3;
    }

    .profile-info .username {
      color: #5a6b80;
      font-size: 0.9rem;
      display: block;
      margin-top: 2px;
    }

    .meta {
      margin: 6px 0;
      color: #3f546e;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    .role.teacher { color: #007bff; font-weight: 600; }
    .role.student { color: #28a745; font-weight: 600; }

    .profile-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn-blue {
      background: linear-gradient(135deg, #007bff, #0047b3);
      color: #fff;
      font-weight: 600;
      padding: 10px 16px;
      border-radius: 8px;
      text-decoration: none;
      text-align: center;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      flex: 1;
      min-width: 140px;
    }

    .btn-blue:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,91,181,0.25); }

    .btn-gray {
      background: #f2f4f8;
      border: 1px solid #d0e0ff;
      color: #002b5c;
      border-radius: 8px;
      padding: 10px 16px;
      font-weight: 600;
      text-decoration: none;
      text-align: center;
      transition: 0.3s;
      font-size: 0.9rem;
      flex: 1;
      min-width: 120px;
    }

    .btn-gray:hover { background: #eef4ff; }

    /* ====== –¢–∞–±–ª–∏—Ü–∞ ====== */
    .table-card {
      background: white;
      border-radius: 14px;
      box-shadow: 0 6px 20px rgba(0,91,181,0.08);
      border: 1px solid #cde0ff;
      padding: 20px;
      margin-bottom: 30px;
      overflow: hidden;
    }

    .table-card h2 { text-align:center; color:#003366; margin-bottom:16px; font-size: 1.3rem; }

    .filters {
      display:flex;
      gap:8px;
      justify-content:center;
      flex-wrap:wrap;
      margin-bottom:16px;
    }

    .filters input, .filters select {
      padding:8px 10px;
      border-radius:6px;
      border:1px solid #cddffb;
      font-size:0.85rem;
      flex: 1;
      min-width: 120px;
      background: white;
    }

    .table-responsive {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .achievement-table {
      width:100%;
      border-collapse:collapse;
      min-width: 600px;
    }

    .achievement-table th, .achievement-table td {
      padding:10px 12px;
      border-bottom:1px solid #e6f2ff;
      text-align: left;
      background: white;
    }

    .achievement-table th {
      background:#f6faff;
      color:#003366;
      font-weight:700;
      font-size: 0.9rem;
    }

    .achievement-table tr:hover { background:#f4f9ff; }

    .download-link {
      color: #007bff;
      text-decoration: none;
      font-weight: 500;
    }

    .action-buttons {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .btn-small {
      border:none;
      border-radius:6px;
      padding:5px 8px;
      font-size:0.75rem;
      font-weight:600;
      cursor:pointer;
      text-decoration:none;
      white-space: nowrap;
    }

    .btn-small.edit { background:#f2f7ff; border:1px solid #b9d4ff; color:#0047b3; }
    .btn-small.delete { background:linear-gradient(135deg,#e04b4b,#b33232); color:#fff; }

    /* ====== –ó–Ω–∞—á–∫–∏ ====== */
    .section-title {
      text-align:center;
      margin:30px 0 15px;
      color:#003366;
      font-size: 1.3rem;
    }

    .achievements-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
      gap:16px;
    }

    .achievement-card {
      background:white;
      border-radius:12px;
      border:1px solid #cde0ff;
      box-shadow:0 4px 10px rgba(0,0,0,0.06);
      overflow:hidden;
      transition:all .3s ease;
    }

    .achievement-card:hover { transform: translateY(-3px); box-shadow:0 8px 15px rgba(0,123,255,0.2); }

    .achievement-thumb {
      width:100%;
      height:140px;
      object-fit:cover;
      background: white;
    }

    .achievement-placeholder {
      height:140px;
      background:linear-gradient(135deg,#f0f8ff,#d9ecff);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#5c7fa3;
      font-weight:600;
      font-size: 0.9rem;
    }

    .achievement-content {
      padding:12px 15px;
      background: white;
    }

    .achievement-content h3 {
      margin:0 0 6px;
      font-size:1rem;
      color:#003366;
      line-height: 1.3;
    }

    .achievement-content p {
      font-size:0.8rem;
      color:#555;
      margin-bottom:6px;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .achievement-content small {
      font-size: 0.75rem;
      color: #666;
    }

    .no-achievements {
      text-align: center;
      padding: 30px;
      color: #666;
      background: white;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–´–• */
    @media (max-width: 768px) {
      .profile-page {
        margin: 15px auto;
        padding: 0 10px 30px;
      }

      .profile-card {
        padding: 16px;
        border-radius: 12px;
      }

      .profile-header {
        flex-direction: column;
        text-align: center;
        gap: 12px;
      }

      .profile-avatar {
        width: 60px;
        height: 60px;
        font-size: 20px;
      }

      .profile-info h1 {
        font-size: 1.2rem;
      }

      .profile-actions {
        flex-direction: column;
      }

      .btn-blue, .btn-gray {
        min-width: auto;
        width: 100%;
      }

      .table-card {
        padding: 16px;
        border-radius: 12px;
      }

      .filters {
        flex-direction: column;
      }

      .filters input, .filters select {
        min-width: auto;
        width: 100%;
      }

      .achievements-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .achievement-thumb,
      .achievement-placeholder {
        height: 120px;
      }
    }

    @media (max-width: 480px) {
      .profile-page {
        margin: 10px auto;
        padding: 0 8px 20px;
      }

      .profile-card {
        padding: 14px;
      }

      .profile-info h1 {
        font-size: 1.1rem;
      }

      .meta {
        font-size: 0.85rem;
      }

      .table-card {
        padding: 14px;
      }

      .achievement-table th,
      .achievement-table td {
        padding: 8px 10px;
        font-size: 0.8rem;
      }

      .action-buttons {
        flex-direction: column;
        gap: 4px;
      }

      .btn-small {
        width: 100%;
        text-align: center;
      }

      .section-title {
        font-size: 1.2rem;
        margin: 25px 0 12px;
      }
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
    @media (max-width: 640px) {
      .achievement-table {
        min-width: 100%;
      }

      .achievement-table thead {
        display: none;
      }

      .achievement-table tr {
        display: block;
        margin-bottom: 12px;
        border: 1px solid #e6f2ff;
        border-radius: 8px;
        background: white;
      }

      .achievement-table td {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 12px;
        border-bottom: 1px solid #f0f4f8;
      }

      .achievement-table td:last-child {
        border-bottom: none;
      }

      .achievement-table td::before {
        content: attr(data-label);
        font-weight: 600;
        color: #003366;
        margin-right: 10px;
        flex-shrink: 0;
      }

      .action-buttons {
        justify-content: flex-end;
      }
    }
  </style>
</head>
<body>
  <!-- –•–µ–¥–µ—Ä -->
  <header>
    <div class="logo">
      <a href="/">–ú–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</a>
    </div>

    <nav>
      {% if user.is_authenticated %}
        {% if user.role == 'teacher' or user.is_teacher %}
          <a href="{% url 'teacher_dashboard' %}" class="{% if request.path == '/teacher/dashboard/' %}active{% endif %}">–ì–ª–∞–≤–Ω–∞—è</a>
          <a href="{% url 'teacher_classes' %}" class="{% if 'classes' in request.path %}active{% endif %}">–ö–ª–∞—Å—Å—ã</a>
          <a href="{% url 'profile' user.username %}" class="{% if 'profile' in request.path %}active{% endif %}">–ü—Ä–æ—Ñ–∏–ª—å</a>
          <a href="{% url 'notifications' %}" class="{% if 'notifications' in request.path %}active{% endif %}">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a>
        {% else %}
          <a href="{% url 'dashboard' %}" class="{% if request.path == '/dashboard/' %}active{% endif %}">–ì–ª–∞–≤–Ω–∞—è</a>
          <a href="{% url 'dashboard' %}" class="{% if 'classes' in request.path %}active{% endif %}">–ú–æ–∏ –∫–ª–∞—Å—Å—ã</a>
          <a href="{% url 'profile' user.username %}" class="{% if 'profile' in request.path %}active{% endif %}">–ü—Ä–æ—Ñ–∏–ª—å</a>
          <a href="{% url 'notifications' %}" class="{% if 'notifications' in request.path %}active{% endif %}">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a>
        {% endif %}

        <div class="user-mini">
          <span>{{ user.get_full_name|default:user.username }}</span>
          <a href="{% url 'logout' %}" class="logout-btn">–í—ã–π—Ç–∏</a>
        </div>
      {% else %}
        <a href="{% url 'login' %}">–í–æ–π—Ç–∏</a>
        <a href="{% url 'register' %}" class="logout-btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
      {% endif %}
    </nav>
  </header>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <div class="main-content">
    <div class="profile-page">
      <!-- üßç –®–∞–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
      <div class="profile-card">
        <div class="profile-header">
          <div class="profile-avatar">
            {% if profile_user.first_name %}
              {{ profile_user.first_name|slice:":1" }}{{ profile_user.last_name|slice:":1" }}
            {% else %}
              {{ profile_user.username|slice:":1"|upper }}
            {% endif %}
          </div>

          <div class="profile-info">
            <h1>{{ profile_user.first_name }} {{ profile_user.last_name }}
              <span class="username">(@{{ profile_user.username }})</span>
            </h1>
            <p class="meta">
              <strong>–®–∫–æ–ª–∞:</strong> –ì–ë–û–£ 444
              {% if profile_user.class_number or profile_user.class_letter %}
              ‚Ä¢ <strong>–ö–ª–∞—Å—Å:</strong> {{ profile_user.class_number }}{{ profile_user.class_letter }}
              {% endif %}
            </p>
            <p class="meta">
              –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: {{ profile_user.date_joined|date:"d.m.Y" }} |
              {% if profile_user.role == 'teacher' or profile_user.is_teacher %}
                <span class="role teacher">–£—á–∏—Ç–µ–ª—å</span>
              {% else %}
                <span class="role student">–£—á–µ–Ω–∏–∫</span>
              {% endif %}
            </p>
          </div>
        </div>

        <div class="profile-actions">
          {% if user.is_authenticated %}
            {% if user == profile_user %}
              <a class="btn-blue" href="{% url 'add_achievement' %}">–î–æ–±–∞–≤–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ</a>
            {% elif user.role == 'teacher' or user.is_teacher %}
              <a class="btn-blue" href="{% url 'add_achievement_for' profile_user.id %}">–î–æ–±–∞–≤–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —É—á–µ–Ω–∏–∫—É</a>
            {% endif %}
            <a class="btn-gray" href="{% url 'notifications' %}">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a>
          {% endif %}
        </div>
      </div>

      <!-- üìã –¢–∞–±–ª–∏—Ü–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π -->
      <div class="table-card">
        <h2>–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</h2>

        <div class="filters">
          <input type="text" id="filterTitle" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é...">
          <select id="filterResult">
            <option value="">–í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</option>
            <option value="–ü–æ–±–µ–¥–∏—Ç–µ–ª—å">–ü–æ–±–µ–¥–∏—Ç–µ–ª—å</option>
            <option value="–ü—Ä–∏–∑—ë—Ä">–ü—Ä–∏–∑—ë—Ä</option>
            <option value="–£—á–∞—Å—Ç–Ω–∏–∫">–£—á–∞—Å—Ç–Ω–∏–∫</option>
            <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
          </select>
          <select id="filterYear">
            <option value="">–í—Å–µ –≥–æ–¥—ã</option>
            {% for ach in achievements %}
              {% if ach.year %}
                <option value="{{ ach.year }}">{{ ach.year }}</option>
              {% endif %}
            {% endfor %}
          </select>
        </div>

        <div class="table-responsive">
          <table id="achievementTable" class="achievement-table">
            <thead>
              <tr>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</th>
                <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                <th>–§–æ—Ç–æ</th>
                <th>–ì–æ–¥</th>
                {% if user == profile_user %}
                  <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                {% endif %}
              </tr>
            </thead>
            <tbody>
              {% for ach in achievements %}
              <tr data-title="{{ ach.title|lower }}" data-result="{{ ach.result }}" data-year="{{ ach.year }}">
                <td data-label="–ù–∞–∑–≤–∞–Ω–∏–µ">{{ ach.title }}</td>
                <td data-label="–†–µ–∑—É–ª—å—Ç–∞—Ç">{{ ach.result }}</td>
                <td data-label="–§–æ—Ç–æ">
                  {% if ach.image %}
                    <a href="{{ ach.image.url }}" download class="download-link">—Å–∫–∞—á–∞—Ç—å</a>
                  {% else %}
                    –ù–µ—Ç —Ñ–æ—Ç–æ
                  {% endif %}
                </td>
                <td data-label="–ì–æ–¥">{{ ach.year }}</td>
                {% if user == profile_user %}
                <td data-label="–î–µ–π—Å—Ç–≤–∏—è">
                  <div class="action-buttons">
                    <a href="{% url 'edit_achievement' ach.id %}" class="btn-small edit">–†–µ–¥.</a>
                    <form method="post" action="{% url 'delete_achievement' ach.id %}" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ?');">
                      {% csrf_token %}
                      <button type="submit" class="btn-small delete">–£–¥–∞–ª.</button>
                    </form>
                  </div>
                </td>
                {% endif %}
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- üèÖ –ó–Ω–∞—á–∫–∏ -->
      <h2 class="section-title">–ó–Ω–∞—á–∫–∏</h2>

      {% if achievements %}
        <div class="achievements-grid">
          {% for ach in achievements %}
            <div class="achievement-card">
              {% if ach.image %}
                <img src="{{ ach.image.url }}" alt="{{ ach.title }}" class="achievement-thumb">
              {% else %}
                <div class="achievement-placeholder">–ù–µ—Ç —Ñ–æ—Ç–æ</div>
              {% endif %}
              <div class="achievement-content">
                <h3>{{ ach.title }}</h3>
                <p>{{ ach.description|truncatechars:120 }}</p>
                <small>{{ ach.result }} {% if ach.year %} ‚Ä¢ {{ ach.year }}{% endif %}</small>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="no-achievements">
          <p>–ó–Ω–∞—á–∫–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- üîπ JS —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const titleFilter = document.getElementById("filterTitle");
    const resultFilter = document.getElementById("filterResult");
    const yearFilter = document.getElementById("filterYear");
    const rows = document.querySelectorAll("#achievementTable tbody tr");

    function applyFilters() {
      const titleVal = titleFilter.value.toLowerCase();
      const resultVal = resultFilter.value;
      const yearVal = yearFilter.value;

      rows.forEach(row => {
        const title = row.dataset.title || '';
        const result = row.dataset.result || '';
        const year = row.dataset.year ? String(row.dataset.year) : '';
        const matchesTitle = title.includes(titleVal);
        const matchesResult = !resultVal || result === resultVal;
        const matchesYear = !yearVal || year === yearVal;
        row.style.display = (matchesTitle && matchesResult && matchesYear) ? "" : "none";
      });
    }

    titleFilter.addEventListener("input", applyFilters);
    resultFilter.addEventListener("change", applyFilters);
    yearFilter.addEventListener("change", applyFilters);
  });
  </script>
</body>
</html>