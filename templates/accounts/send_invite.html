{% extends 'base.html' %}
{% block title %}–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å —É—á–µ–Ω–∏–∫–∞ –≤ {{ classroom.name }}{% endblock %}
{% block content %}
<div class="invite-page">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π -->
  <div class="invite-header">
    <div class="header-content">
      <h1 class="page-title">
        <span class="title-icon">üë•</span>
        –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å —É—á–µ–Ω–∏–∫–∞
      </h1>
      <p class="page-subtitle">–û—Ç–ø—Ä–∞–≤—å—Ç–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ –∫–ª–∞—Å—Å "{{ classroom.name }}"</p>
    </div>
    <div class="header-decoration">
      <div class="decoration-circle circle-1"></div>
      <div class="decoration-circle circle-2"></div>
      <div class="decoration-circle circle-3"></div>
    </div>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <div class="invite-container">
    <div class="invite-card">
      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Å–µ -->
      <div class="class-info-section">
        <div class="class-avatar">
          <div class="avatar-icon">üè´</div>
        </div>
        <div class="class-details">
          <h3>{{ classroom.name }}</h3>
          <div class="class-meta">
            <span class="meta-item">
              <span class="meta-icon">üìö</span>
              –ì–ë–û–£ 444
            </span>
            <span class="meta-item">
              <span class="meta-icon">üéí</span>
              {{ classroom.grade }}
            </span>
            <span class="meta-item">
              <span class="meta-icon">üë•</span>
              {{ classroom.students.count }} —É—á–µ–Ω–∏–∫–æ–≤
            </span>
          </div>
          {% if classroom.description %}
          <p class="class-description">{{ classroom.description }}</p>
          {% endif %}
        </div>
      </div>

      <!-- –§–æ—Ä–º–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è -->
      <div class="invite-form-section">
        <form method="post" class="invite-form" id="inviteForm">
          {% csrf_token %}

          <div class="form-group animated-field">
            <label for="userSearch" class="form-label">
              <span class="label-icon">üîç</span>
              –ü–æ–∏—Å–∫ —É—á–µ–Ω–∏–∫–∞
            </label>
            <div class="search-container">
              <div class="search-input-wrapper">
                <input type="text"
                       id="userSearch"
                       class="search-input"
                       placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è, —Ñ–∞–º–∏–ª–∏—é –∏–ª–∏ –ª–æ–≥–∏–Ω —É—á–µ–Ω–∏–∫–∞..."
                       autocomplete="off">
                <div class="search-icon">üîç</div>
                <div class="loading-spinner" id="loadingSpinner" style="display: none;">
                  <div class="spinner"></div>
                </div>
              </div>

              <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
              <div class="search-results" id="searchResults" style="display: none;"></div>

              <!-- –í—ã–±—Ä–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -->
              <div class="selected-user" id="selectedUser" style="display: none;">
                <div class="selected-user-card">
                  <div class="user-avatar">
                    <span id="selectedUserAvatar">üë§</span>
                  </div>
                  <div class="user-info">
                    <h4 id="selectedUserName"></h4>
                    <p id="selectedUserDetails"></p>
                  </div>
                  <button type="button" class="remove-user-btn" onclick="clearSelectedUser()">
                    <span class="remove-icon">√ó</span>
                  </button>
                </div>
                <input type="hidden" name="to_user" id="selectedUserId">
              </div>
            </div>
            <div class="field-hint">–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∏–º—è, —Ñ–∞–º–∏–ª–∏—é –∏–ª–∏ –ª–æ–≥–∏–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞ —É—á–µ–Ω–∏–∫–æ–≤</div>
          </div>

          <!-- –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è -->
          <div class="invite-preview">
            <div class="preview-header">
              <h4>–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</h4>
              <div class="preview-badge">–ü—Ä–∏–º–µ—Ä</div>
            </div>
            <div class="preview-content">
              <div class="preview-avatar">üë§</div>
              <div class="preview-text">
                <p class="preview-title">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ –∫–ª–∞—Å—Å</p>
                <p class="preview-subtitle">–í—ã –±—É–¥–µ—Ç–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω—ã –≤ –∫–ª–∞—Å—Å "{{ classroom.name }}"</p>
                <div class="preview-meta">
                  <span class="preview-meta-item">–û—Ç: {{ request.user.get_full_name|default:request.user.username }}</span>
                  <span class="preview-meta-item">–®–∫–æ–ª–∞: –ì–ë–û–£ 444</span>
                </div>
              </div>
            </div>
          </div>

          <!-- –î–µ–π—Å—Ç–≤–∏—è —Ñ–æ—Ä–º—ã -->
          <div class="form-actions">
            <a href="{% url 'class_detail' classroom.id %}" class="btn btn-secondary">
              <span class="btn-icon">‚Üê</span>
              –ù–∞–∑–∞–¥ –∫ –∫–ª–∞—Å—Å—É
            </a>
            <button type="submit" class="btn btn-primary btn-send" id="submitBtn" disabled>
              <span class="btn-icon">‚úâÔ∏è</span>
              –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
              <span class="btn-sparkle">‚ú®</span>
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ -->
    <div class="invite-sidebar">
      <div class="sidebar-card">
        <div class="sidebar-header">
          <div class="sidebar-icon">üí°</div>
          <h4>–ö–∞–∫ –Ω–∞–π—Ç–∏ —É—á–µ–Ω–∏–∫–∞</h4>
        </div>
        <div class="sidebar-content">
          <div class="tip-item">
            <div class="tip-number">1</div>
            <div class="tip-text">
              <strong>–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–ª–∏ —Ñ–∞–º–∏–ª–∏—é</strong>
              <p>–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∏–º—è —É—á–µ–Ω–∏–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞</p>
            </div>
          </div>
          <div class="tip-item">
            <div class="tip-number">2</div>
            <div class="tip-text">
              <strong>–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞</strong>
              <p>–°–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∂–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —É—á–µ–Ω–∏–∫–æ–≤</p>
            </div>
          </div>
          <div class="tip-item">
            <div class="tip-number">3</div>
            <div class="tip-text">
              <strong>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</strong>
              <p>–£—á–µ–Ω–∏–∫ –ø–æ–ª—É—á–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–∏</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.invite-page {
  min-height: 100vh;
  background: linear-gradient(135deg, #f8fbff 0%, #e8f4ff 100%);
  padding: 40px 20px;
  animation: fadeIn 0.8s ease;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
.invite-header {
  background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
  border-radius: 20px;
  padding: 40px;
  color: white;
  margin-bottom: 30px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 15px 35px rgba(0, 123, 255, 0.2);
  animation: slideDown 0.6s ease;
}

.header-content {
  position: relative;
  z-index: 2;
}

.page-title {
  font-size: 2.5rem;
  font-weight: 800;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 15px;
}

.title-icon {
  font-size: 2.2rem;
  animation: bounce 2s infinite;
}

.page-subtitle {
  font-size: 1.2rem;
  opacity: 0.9;
  margin: 0;
}

/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
.invite-container {
  display: grid;
  grid-template-columns: 1fr 350px;
  gap: 30px;
  max-width: 1200px;
  margin: 0 auto;
}

/* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è */
.invite-card {
  background: white;
  border-radius: 20px;
  padding: 40px;
  box-shadow: 0 10px 30px rgba(0, 91, 181, 0.1);
  border: 1px solid #e8f4ff;
  animation: slideUp 0.6s ease 0.2s both;
}

/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Å–µ */
.class-info-section {
  display: flex;
  align-items: center;
  gap: 20px;
  padding: 25px;
  background: linear-gradient(135deg, #f8fbff 0%, #f0f7ff 100%);
  border-radius: 15px;
  margin-bottom: 30px;
  border: 1px solid #e8f4ff;
}

.class-avatar {
  flex-shrink: 0;
}

.avatar-icon {
  width: 80px;
  height: 80px;
  background: linear-gradient(135deg, #007bff, #0056b3);
  border-radius: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5rem;
}

.class-details h3 {
  color: #003366;
  margin: 0 0 10px 0;
  font-size: 1.5rem;
}

.class-meta {
  display: flex;
  gap: 15px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}

.meta-item {
  display: flex;
  align-items: center;
  gap: 6px;
  background: white;
  padding: 6px 12px;
  border-radius: 8px;
  font-size: 0.9rem;
  color: #555;
  border: 1px solid #e8f4ff;
}

.meta-icon {
  font-size: 0.8rem;
}

.class-description {
  color: #666;
  margin: 0;
  font-size: 0.95rem;
  line-height: 1.5;
}

/* –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
.search-container {
  position: relative;
}

.search-input-wrapper {
  position: relative;
}

.search-input {
  width: 100%;
  padding: 16px 50px 16px 20px;
  border: 2px solid #e8f4ff;
  border-radius: 12px;
  background: #f8fbff;
  font-size: 1rem;
  transition: all 0.3s ease;
  font-family: inherit;
}

.search-input:focus {
  outline: none;
  border-color: #007bff;
  background: white;
  box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.1);
}

.search-icon {
  position: absolute;
  right: 20px;
  top: 50%;
  transform: translateY(-50%);
  color: #6c757d;
  font-size: 1.1rem;
}

.loading-spinner {
  position: absolute;
  right: 50px;
  top: 50%;
  transform: translateY(-50%);
}

.spinner {
  width: 20px;
  height: 20px;
  border: 2px solid #e8f4ff;
  border-top: 2px solid #007bff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ */
.search-results {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: white;
  border: 2px solid #e8f4ff;
  border-top: none;
  border-radius: 0 0 12px 12px;
  box-shadow: 0 10px 30px rgba(0, 91, 181, 0.1);
  max-height: 300px;
  overflow-y: auto;
  z-index: 1000;
}

.user-result {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 15px 20px;
  cursor: pointer;
  transition: all 0.2s ease;
  border-bottom: 1px solid #f0f4f8;
}

.user-result:last-child {
  border-bottom: none;
}

.user-result:hover {
  background: #f8fbff;
}

.user-avatar-small {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, #007bff, #0056b3);
  color: white;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  font-weight: 600;
  flex-shrink: 0;
}

.user-info-small h5 {
  margin: 0 0 4px 0;
  color: #003366;
  font-size: 0.95rem;
}

.user-info-small p {
  margin: 0;
  color: #666;
  font-size: 0.85rem;
}

.no-results {
  padding: 20px;
  text-align: center;
  color: #666;
}

/* –í—ã–±—Ä–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å */
.selected-user-card {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 20px;
  background: linear-gradient(135deg, #f0fff4, #e8f8ec);
  border: 2px solid #28a745;
  border-radius: 12px;
  margin-top: 15px;
  animation: slideUp 0.3s ease;
}

.user-avatar {
  width: 50px;
  height: 50px;
  background: #28a745;
  color: white;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  font-weight: 600;
  flex-shrink: 0;
}

.user-info {
  flex: 1;
}

.user-info h4 {
  margin: 0 0 4px 0;
  color: #003366;
  font-size: 1.1rem;
}

.user-info p {
  margin: 0;
  color: #666;
  font-size: 0.9rem;
}

.remove-user-btn {
  background: none;
  border: none;
  font-size: 1.5rem;
  color: #dc3545;
  cursor: pointer;
  padding: 5px;
  border-radius: 6px;
  transition: all 0.2s ease;
}

.remove-user-btn:hover {
  background: #f8d7da;
}

/* –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä */
.invite-preview {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border: 2px dashed #dee2e6;
  border-radius: 15px;
  padding: 25px;
  margin: 30px 0;
  transition: all 0.3s ease;
}

.invite-preview:hover {
  border-color: #007bff;
  background: linear-gradient(135deg, #f0f7ff 0%, #e8f4ff 100%);
}

.preview-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.preview-header h4 {
  color: #003366;
  margin: 0;
  font-size: 1.1rem;
}

.preview-badge {
  background: #007bff;
  color: white;
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 0.8rem;
  font-weight: 600;
}

.preview-content {
  display: flex;
  align-items: center;
  gap: 15px;
}

.preview-avatar {
  width: 50px;
  height: 50px;
  background: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  flex-shrink: 0;
  border: 2px solid #e8f4ff;
}

.preview-text {
  flex: 1;
}

.preview-title {
  font-weight: 700;
  color: #003366;
  margin: 0 0 5px 0;
}

.preview-subtitle {
  color: #666;
  margin: 0 0 10px 0;
  font-size: 0.9rem;
}

.preview-meta {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.preview-meta-item {
  font-size: 0.8rem;
  color: #888;
}

/* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
.invite-sidebar {
  display: flex;
  flex-direction: column;
  gap: 25px;
}

.sidebar-card {
  background: white;
  border-radius: 15px;
  padding: 25px;
  box-shadow: 0 5px 20px rgba(0, 91, 181, 0.08);
  border: 1px solid #e8f4ff;
  animation: slideUp 0.6s ease 0.4s both;
}

.sidebar-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
}

.sidebar-icon {
  font-size: 1.5rem;
}

.sidebar-header h4 {
  color: #003366;
  margin: 0;
  font-size: 1.1rem;
}

.tip-item {
  display: flex;
  gap: 15px;
  margin-bottom: 20px;
}

.tip-item:last-child {
  margin-bottom: 0;
}

.tip-number {
  width: 30px;
  height: 30px;
  background: linear-gradient(135deg, #007bff, #0056b3);
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.9rem;
  font-weight: 700;
  flex-shrink: 0;
}

.tip-text strong {
  display: block;
  color: #003366;
  margin-bottom: 4px;
  font-size: 0.95rem;
}

.tip-text p {
  color: #666;
  font-size: 0.85rem;
  margin: 0;
  line-height: 1.4;
}

/* –ö–Ω–æ–ø–∫–∏ */
.btn {
  padding: 14px 28px;
  border-radius: 12px;
  text-decoration: none;
  font-weight: 700;
  font-size: 1rem;
  transition: all 0.3s ease;
  border: none;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.btn-secondary {
  background: #f8f9fa;
  color: #003366;
  border: 2px solid #e9ecef;
}

.btn-primary {
  background: linear-gradient(135deg, #007bff, #0056b3);
  color: white;
  box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3);
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none !important;
  box-shadow: none !important;
}

.btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0, 123, 255, 0.4);
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-30px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes slideUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
  40% { transform: translateY(-10px); }
  60% { transform: translateY(-5px); }
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1024px) {
  .invite-container {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  .invite-page {
    padding: 20px 15px;
  }

  .invite-header {
    padding: 30px 25px;
  }

  .page-title {
    font-size: 2rem;
    flex-direction: column;
    gap: 10px;
    text-align: center;
  }

  .invite-card {
    padding: 30px 25px;
  }

  .class-info-section {
    flex-direction: column;
    text-align: center;
  }

  .form-actions {
    flex-direction: column;
    gap: 15px;
  }
}
</style>

<script>
let searchTimeout;

document.addEventListener('DOMContentLoaded', function() {
  const userSearch = document.getElementById('userSearch');
  const searchResults = document.getElementById('searchResults');
  const loadingSpinner = document.getElementById('loadingSpinner');
  const selectedUser = document.getElementById('selectedUser');
  const submitBtn = document.getElementById('submitBtn');

  // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  userSearch.addEventListener('input', function() {
    const query = this.value.trim();

    // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–∞—É—Ç
    clearTimeout(searchTimeout);

    // –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –ø—É—Å—Ç–æ–π
    if (query.length === 0) {
      searchResults.style.display = 'none';
      loadingSpinner.style.display = 'none';
      return;
    }

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    loadingSpinner.style.display = 'block';
    searchResults.style.display = 'none';

    // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–∏—Å–∫–æ–º (–¥–µ–±–∞—É–Ω—Å)
    searchTimeout = setTimeout(() => {
      searchUsers(query);
    }, 300);
  });

  // –ó–∞–∫—Ä—ã—Ç–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –æ–±–ª–∞—Å—Ç–∏
  document.addEventListener('click', function(e) {
    if (!e.target.closest('.search-container')) {
      searchResults.style.display = 'none';
      loadingSpinner.style.display = 'none';
    }
  });
});

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ —Ä–µ–∞–ª—å–Ω—ã–π API
function searchUsers(query) {
  const loadingSpinner = document.getElementById('loadingSpinner');
  const searchResults = document.getElementById('searchResults');

  // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π API endpoint
  fetch(`/accounts/api/search-users/?q=${encodeURIComponent(query)}`)
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.json();
    })
    .then(users => {
      loadingSpinner.style.display = 'none';
      displaySearchResults(users);
    })
    .catch(error => {
      console.error('Error searching users:', error);
      loadingSpinner.style.display = 'none';
      searchResults.innerHTML = '<div class="no-results">–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>';
      searchResults.style.display = 'block';
    });
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
function displaySearchResults(users) {
  const searchResults = document.getElementById('searchResults');

  if (users.length === 0) {
    searchResults.innerHTML = '<div class="no-results">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
    searchResults.style.display = 'block';
    return;
  }

  let html = '';
  users.forEach(user => {
    // –°–æ–∑–¥–∞–µ–º –∞–≤–∞—Ç–∞—Ä –∏–∑ –∏–Ω–∏—Ü–∏–∞–ª–æ–≤
    const firstName = user.first_name || '';
    const lastName = user.last_name || '';
    const avatarText = (firstName.charAt(0) + lastName.charAt(0)).toUpperCase() || user.username.charAt(0).toUpperCase();

    // –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è
    const fullName = `${firstName} ${lastName}`.trim() || user.username;

    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Å–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    const classInfo = user.class_number ? ` ‚Ä¢ ${user.class_number}${user.class_letter || ''} –∫–ª–∞—Å—Å` : '';

    html += `
      <div class="user-result" onclick="selectUser(${user.id}, '${firstName}', '${lastName}', '${user.username}', '${avatarText}')">
        <div class="user-avatar-small">${avatarText}</div>
        <div class="user-info-small">
          <h5>${fullName}</h5>
          <p>@${user.username}${classInfo}</p>
        </div>
      </div>
    `;
  });

  searchResults.innerHTML = html;
  searchResults.style.display = 'block';
}

// –í—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function selectUser(userId, firstName, lastName, username, avatarText) {
  const selectedUser = document.getElementById('selectedUser');
  const selectedUserName = document.getElementById('selectedUserName');
  const selectedUserDetails = document.getElementById('selectedUserDetails');
  const selectedUserAvatar = document.getElementById('selectedUserAvatar');
  const selectedUserId = document.getElementById('selectedUserId');
  const userSearch = document.getElementById('userSearch');
  const searchResults = document.getElementById('searchResults');
  const submitBtn = document.getElementById('submitBtn');

  // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const fullName = `${firstName || ''} ${lastName || ''}`.trim() || username;
  selectedUserName.textContent = fullName;
  selectedUserDetails.textContent = `@${username}`;
  selectedUserAvatar.textContent = avatarText;
  selectedUserId.value = userId;

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
  selectedUser.style.display = 'block';
  searchResults.style.display = 'none';
  userSearch.value = '';

  // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
  submitBtn.disabled = false;
}

// –û—á–∏—Å—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function clearSelectedUser() {
  const selectedUser = document.getElementById('selectedUser');
  const selectedUserId = document.getElementById('selectedUserId');
  const submitBtn = document.getElementById('submitBtn');

  selectedUser.style.display = 'none';
  selectedUserId.value = '';
  submitBtn.disabled = true;
}
</script>
{% endblock %}