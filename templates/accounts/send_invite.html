<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å —É—á–µ–Ω–∏–∫–∞ –≤ {{ classroom.name }} ‚Äî –ú–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</title>
  <style>
    /* –°–ë–†–û–° –°–¢–ò–õ–ï–ô */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      background: linear-gradient(135deg, #f8fbff 0%, #e8f4ff 100%);
      font-family: "Segoe UI", Roboto, -apple-system, BlinkMacSystemFont, Arial, sans-serif;
      font-size: 13px;
      line-height: 1.3;
    }

    /* HEADER */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(90deg, #0077e6 0%, #005bb5 100%);
      color: #fff;
      z-index: 1200;
      box-shadow: 0 3px 8px rgba(3, 36, 74, 0.12);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 12px;
      width: 100%;
      height: 55px;
    }

    .logo a {
      font-weight: 700;
      font-size: 1rem;
      color: #fff;
      text-decoration: none;
      white-space: nowrap;
    }

    nav {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: flex-end;
      flex: 1;
    }

    nav a {
      color: rgba(255, 255, 255, 0.95);
      text-decoration: none;
      padding: 5px 7px;
      border-radius: 5px;
      font-weight: 600;
      transition: all 0.22s;
      font-size: 0.8rem;
      white-space: nowrap;
    }

    nav a:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: translateY(-1px);
    }

    .logout-btn {
      background: rgba(220, 53, 69, 0.9);
      color: white;
      padding: 5px 8px;
      border-radius: 5px;
      text-decoration: none;
      font-weight: 600;
      font-size: 0.75rem;
      border: none;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.3s ease;
      margin-left: 5px;
    }

    .logout-btn:hover {
      background: #dc3545;
      transform: translateY(-1px);
    }

    /* –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ */
    .main-content {
      padding-top: 55px;
      min-height: 100vh;
      background: transparent;
    }

    .invite-page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 20px 50px;
      animation: fadeIn 0.6s ease;
    }

    /* ====== –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ====== */
    .page-header {
      margin-bottom: 30px;
      text-align: center;
      padding: 0 10px;
    }

    .page-header h1 {
      font-size: 1.8rem;
      color: #002b5c;
      margin-bottom: 10px;
      line-height: 1.2;
      font-weight: 700;
    }

    .page-header p {
      color: #5a6b80;
      font-size: 1rem;
      max-width: 700px;
      margin: 0 auto;
      line-height: 1.4;
    }

    /* ====== –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –¥–≤—É–º—è –∫–æ–ª–æ–Ω–∫–∞–º–∏ ====== */
    .main-container {
      display: grid;
      grid-template-columns: 1fr 350px;
      gap: 25px;
      margin-bottom: 30px;
    }

    /* ====== –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ ====== */
    .left-column {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Å–µ */
    .class-card {
      background: white;
      border-radius: 14px;
      box-shadow: 0 6px 20px rgba(0, 87, 174, 0.12);
      border: 1px solid #cde0ff;
      padding: 25px;
      display: flex;
      align-items: center;
      gap: 20px;
      transition: all 0.3s ease;
    }

    .class-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0, 123, 255, 0.15);
    }

    .class-icon {
      background: linear-gradient(135deg, #007bff, #0047b3);
      color: white;
      width: 70px;
      height: 70px;
      border-radius: 14px;
      font-size: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .class-details h2 {
      margin: 0 0 8px 0;
      font-size: 1.3rem;
      color: #002b5c;
    }

    .class-meta {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .meta-item {
      display: flex;
      align-items: center;
      gap: 6px;
      background: #f8fbff;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 0.85rem;
      color: #5a6b80;
      border: 1px solid #e8f4ff;
    }

    .meta-icon {
      font-size: 0.9rem;
    }

    .class-description {
      color: #5a6b80;
      font-size: 0.9rem;
      line-height: 1.4;
      margin: 10px 0 0 0;
    }

    /* –§–æ—Ä–º–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è */
    .form-card {
      background: white;
      border-radius: 14px;
      box-shadow: 0 6px 20px rgba(0, 87, 174, 0.12);
      border: 1px solid #cde0ff;
      padding: 25px;
      flex: 1;
    }

    .form-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    .form-header-icon {
      background: linear-gradient(135deg, #28a745, #1e7e34);
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }

    .form-header h2 {
      color: #002b5c;
      margin: 0;
      font-size: 1.3rem;
    }

    .form-header p {
      color: #5a6b80;
      font-size: 0.85rem;
      margin: 4px 0 0 0;
    }

    /* –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ */
    .search-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-group label {
      font-weight: 600;
      color: #003366;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .form-group label .label-icon {
      font-size: 1rem;
    }

    .search-container {
      position: relative;
    }

    .search-input-wrapper {
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 14px 45px 14px 16px;
      border: 1.5px solid #e8f4ff;
      border-radius: 10px;
      background: #f9fcff;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    .search-input:focus {
      border-color: #007bff;
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.15);
      outline: none;
      background: white;
      transform: translateY(-1px);
    }

    .search-icon {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: #6c757d;
      font-size: 1rem;
    }

    .loading-spinner {
      position: absolute;
      right: 40px;
      top: 50%;
      transform: translateY(-50%);
      display: none;
    }

    .spinner {
      width: 18px;
      height: 18px;
      border: 2px solid #e8f4ff;
      border-top: 2px solid #007bff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .form-hint {
      color: #5a6b80;
      font-size: 0.8rem;
      margin-top: 4px;
      line-height: 1.4;
    }

    /* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ */
    .search-results {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1.5px solid #e8f4ff;
      border-top: none;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 6px 20px rgba(0, 91, 181, 0.1);
      max-height: 250px;
      overflow-y: auto;
      z-index: 1000;
      display: none;
    }

    .user-result {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      border-bottom: 1px solid #f0f4f8;
    }

    .user-result:last-child {
      border-bottom: none;
    }

    .user-result:hover {
      background: #f8fbff;
    }

    .user-avatar-small {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, #007bff, #0047b3);
      color: white;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      font-weight: 600;
      flex-shrink: 0;
    }

    .user-info-small h5 {
      margin: 0 0 3px 0;
      color: #003366;
      font-size: 0.9rem;
    }

    .user-info-small p {
      margin: 0;
      color: #666;
      font-size: 0.8rem;
    }

    .no-results {
      padding: 20px;
      text-align: center;
      color: #666;
      font-size: 0.85rem;
    }

    /* –í—ã–±—Ä–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å */
    .selected-user {
      margin-top: 15px;
      display: none;
    }

    .selected-user-card {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 18px 20px;
      background: linear-gradient(135deg, #f0fff4, #e8f8ec);
      border: 1.5px solid #28a745;
      border-radius: 10px;
      animation: slideUp 0.3s ease;
    }

    .user-avatar {
      width: 45px;
      height: 45px;
      background: #28a745;
      color: white;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      font-weight: 600;
      flex-shrink: 0;
    }

    .user-info {
      flex: 1;
    }

    .user-info h4 {
      margin: 0 0 4px 0;
      color: #003366;
      font-size: 1rem;
    }

    .user-info p {
      margin: 0;
      color: #666;
      font-size: 0.85rem;
    }

    .remove-user-btn {
      background: none;
      border: none;
      font-size: 1.2rem;
      color: #dc3545;
      cursor: pointer;
      padding: 5px;
      border-radius: 6px;
      transition: all 0.2s ease;
      line-height: 1;
    }

    .remove-user-btn:hover {
      background: #f8d7da;
    }

    /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
    .action-buttons {
      display: flex;
      gap: 15px;
      margin-top: 25px;
      flex-wrap: wrap;
    }

    .btn {
      text-decoration: none;
      padding: 14px 28px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      text-align: center;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      flex: 1;
      min-width: 180px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #28a745, #1e7e34);
      color: white;
      box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
    }

    .btn-secondary {
      background: #f2f4f8;
      border: 1px solid #d0e0ff;
      color: #002b5c;
    }

    .btn-secondary:hover {
      background: #eef4ff;
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0, 123, 255, 0.1);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }

    .btn-icon {
      font-size: 1.1rem;
    }

    /* ====== –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –ü–æ–º–æ—â—å ====== */
    .right-column {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    /* –ë–ª–æ–∫ –ø–æ–º–æ—â–∏ */
    .help-card {
      background: white;
      border-radius: 14px;
      box-shadow: 0 6px 20px rgba(0, 87, 174, 0.12);
      border: 1px solid #cde0ff;
      padding: 25px;
    }

    .help-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    .help-header-icon {
      background: linear-gradient(135deg, #ff9800, #f57c00);
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }

    .help-header h2 {
      color: #002b5c;
      margin: 0;
      font-size: 1.3rem;
    }

    .help-steps {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .help-step {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px 15px;
      background: #f8fbff;
      border-radius: 10px;
      border: 1px solid #e8f4ff;
      transition: all 0.3s ease;
    }

    .help-step:hover {
      transform: translateX(5px);
      border-color: #007bff;
    }

    .step-number {
      background: linear-gradient(135deg, #007bff, #0047b3);
      color: white;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.9rem;
      flex-shrink: 0;
    }

    .step-content {
      flex: 1;
    }

    .step-title {
      font-weight: 600;
      color: #002b5c;
      font-size: 0.9rem;
      margin-bottom: 3px;
    }

    .step-desc {
      color: #5a6b80;
      font-size: 0.8rem;
      line-height: 1.3;
    }

    /* –ë–ª–æ–∫ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ */
    .example-card {
      background: white;
      border-radius: 14px;
      box-shadow: 0 6px 20px rgba(0, 87, 174, 0.12);
      border: 1px solid #cde0ff;
      padding: 25px;
      flex: 1;
    }

    .example-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    .example-header-icon {
      background: linear-gradient(135deg, #17a2b8, #117a8b);
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }

    .example-header h2 {
      color: #002b5c;
      margin: 0;
      font-size: 1.3rem;
    }

    .example-content {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .example-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 15px;
      background: #f8fbff;
      border-radius: 10px;
      border: 1px solid #e8f4ff;
      transition: all 0.3s ease;
    }

    .example-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 123, 255, 0.1);
      border-color: #007bff;
    }

    .example-icon {
      background: linear-gradient(135deg, #007bff, #0047b3);
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      flex-shrink: 0;
    }

    .example-item h3 {
      color: #002b5c;
      margin: 0 0 6px 0;
      font-size: 0.95rem;
      font-weight: 600;
    }

    .example-item p {
      color: #5a6b80;
      font-size: 0.8rem;
      line-height: 1.4;
      margin: 0;
    }

    /* ====== –û—à–∏–±–∫–∏ ====== */
    .form-errors {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .form-errors ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .form-errors li {
      color: #721c24;
      font-size: 0.85rem;
      margin-bottom: 5px;
      padding-left: 20px;
      position: relative;
    }

    .form-errors li:before {
      content: "‚ö†Ô∏è";
      position: absolute;
      left: 0;
      top: 1px;
    }

    /* ====== –ê–Ω–∏–º–∞—Ü–∏–∏ ====== */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ====== –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ ====== */
    @media (max-width: 1024px) {
      .main-container {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      .left-column, .right-column {
        gap: 20px;
      }
    }

    @media (max-width: 768px) {
      .invite-page {
        padding: 20px 15px 40px;
      }

      .page-header h1 {
        font-size: 1.5rem;
      }

      .page-header p {
        font-size: 0.9rem;
      }

      .class-card,
      .form-card,
      .help-card,
      .example-card {
        padding: 20px;
      }

      .class-card {
        flex-direction: column;
        text-align: center;
        gap: 15px;
      }

      .class-meta {
        justify-content: center;
      }

      .action-buttons {
        flex-direction: column;
      }

      .btn {
        min-width: auto;
        width: 100%;
      }

      .form-header,
      .help-header,
      .example-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .form-header-icon,
      .help-header-icon,
      .example-header-icon {
        align-self: flex-start;
      }
    }

    @media (max-width: 480px) {
      .invite-page {
        padding: 15px 10px 30px;
      }

      .page-header h1 {
        font-size: 1.3rem;
      }

      .meta-item {
        font-size: 0.8rem;
        padding: 5px 10px;
      }

      .search-input {
        padding: 12px 40px 12px 14px;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <!-- –•–µ–¥–µ—Ä -->
  <header>
    <div class="logo">
      <a href="/">–ú–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</a>
    </div>

    <nav>
      {% if user.is_authenticated %}
        {% if user.role == 'teacher' or user.is_teacher %}
          <a href="{% url 'teacher_dashboard' %}" class="{% if request.path == '/teacher/dashboard/' %}active{% endif %}">–ì–ª–∞–≤–Ω–∞—è</a>
          <a href="{% url 'teacher_classes' %}" class="{% if 'classes' in request.path %}active{% endif %}">–ö–ª–∞—Å—Å—ã</a>
          <a href="{% url 'profile' user.username %}" class="{% if 'profile' in request.path %}active{% endif %}">–ü—Ä–æ—Ñ–∏–ª—å</a>
          <a href="{% url 'notifications' %}" class="{% if 'notifications' in request.path %}active{% endif %}">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a>
        {% else %}
          <a href="{% url 'dashboard' %}" class="{% if request.path == '/dashboard/' %}active{% endif %}">–ì–ª–∞–≤–Ω–∞—è</a>
          <a href="{% url 'dashboard' %}" class="{% if 'classes' in request.path %}active{% endif %}">–ú–æ–∏ –∫–ª–∞—Å—Å—ã</a>
          <a href="{% url 'profile' user.username %}" class="{% if 'profile' in request.path %}active{% endif %}">–ü—Ä–æ—Ñ–∏–ª—å</a>
          <a href="{% url 'notifications' %}" class="{% if 'notifications' in request.path %}active{% endif %}">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a>
        {% endif %}

        <div class="user-mini">
          <span>{{ user.get_full_name|default:user.username }}</span>
          <a href="{% url 'logout' %}" class="logout-btn">–í—ã–π—Ç–∏</a>
        </div>
      {% else %}
        <a href="{% url 'login' %}">–í–æ–π—Ç–∏</a>
        <a href="{% url 'register' %}" class="logout-btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
      {% endif %}
    </nav>
  </header>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <div class="main-content">
    <div class="invite-page">
      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
      <div class="page-header">
        <h1>–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —É—á–µ–Ω–∏–∫–∞ –≤ –∫–ª–∞—Å—Å</h1>
        <p>–ù–∞–π–¥–∏—Ç–µ –∏ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ —É—á–µ–Ω–∏–∫–æ–≤ –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –≤–∞—à–µ–º—É –∫–ª–∞—Å—Å—É</p>
      </div>

      <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –¥–≤—É–º—è –∫–æ–ª–æ–Ω–∫–∞–º–∏ -->
      <div class="main-container">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="left-column">
          <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Å–µ -->
          <div class="class-card">
            <div class="class-icon">üè´</div>
            <div class="class-details">
              <h2>{{ classroom.name }}</h2>
              <div class="class-meta">
                <span class="meta-item">
                  <span class="meta-icon">üìö</span>
                  –ì–ë–û–£ 444
                </span>
                <span class="meta-item">
                  <span class="meta-icon">üéí</span>
                  {{ classroom.grade }}
                </span>
                <span class="meta-item">
                  <span class="meta-icon">üë•</span>
                  {{ classroom.students.count }} —É—á–µ–Ω–∏–∫–æ–≤
                </span>
              </div>
              {% if classroom.description %}
                <p class="class-description">{{ classroom.description }}</p>
              {% endif %}
            </div>
          </div>

          <!-- –§–æ—Ä–º–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è -->
          <div class="form-card">
            <div class="form-header">
              <div class="form-header-icon">üë§</div>
              <div>
                <h2>–ü–æ–∏—Å–∫ —É—á–µ–Ω–∏–∫–∞</h2>
                <p>–ù–∞–π–¥–∏—Ç–µ —É—á–µ–Ω–∏–∫–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</p>
              </div>
            </div>

            {% if form.errors %}
              <div class="form-errors">
                <ul>
                  {% for field, errors in form.errors.items %}
                    {% for error in errors %}
                      <li>{{ error }}</li>
                    {% endfor %}
                  {% endfor %}
                </ul>
              </div>
            {% endif %}

            <form method="post" class="search-form" id="inviteForm">
              {% csrf_token %}

              <!-- –ü–æ–∏—Å–∫ —É—á–µ–Ω–∏–∫–∞ -->
              <div class="form-group">
                <label for="userSearch">
                  <span class="label-icon">üîç</span>
                  –ü–æ–∏—Å–∫ —É—á–µ–Ω–∏–∫–∞
                </label>
                <div class="search-container">
                  <div class="search-input-wrapper">
                    <input type="text"
                           id="userSearch"
                           class="search-input"
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è, —Ñ–∞–º–∏–ª–∏—é –∏–ª–∏ –ª–æ–≥–∏–Ω —É—á–µ–Ω–∏–∫–∞..."
                           autocomplete="off">
                    <div class="search-icon">üîç</div>
                    <div class="loading-spinner" id="loadingSpinner">
                      <div class="spinner"></div>
                    </div>
                  </div>

                  <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
                  <div class="search-results" id="searchResults"></div>

                  <!-- –í—ã–±—Ä–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -->
                  <div class="selected-user" id="selectedUser">
                    <div class="selected-user-card">
                      <div class="user-avatar">
                        <span id="selectedUserAvatar">üë§</span>
                      </div>
                      <div class="user-info">
                        <h4 id="selectedUserName"></h4>
                        <p id="selectedUserDetails"></p>
                      </div>
                      <button type="button" class="remove-user-btn" onclick="clearSelectedUser()">
                        √ó
                      </button>
                    </div>
                    <input type="hidden" name="to_user" id="selectedUserId">
                  </div>
                </div>
                <div class="form-hint">–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∏–º—è, —Ñ–∞–º–∏–ª–∏—é –∏–ª–∏ –ª–æ–≥–∏–Ω —É—á–µ–Ω–∏–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞</div>
              </div>

              <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
              <div class="action-buttons">
                <a href="{% url 'class_detail' classroom.id %}" class="btn btn-secondary">
                  <span class="btn-icon">‚Üê</span>
                  –ù–∞–∑–∞–¥ –∫ –∫–ª–∞—Å—Å—É
                </a>
                <button type="submit" class="btn btn-primary" id="submitBtn" disabled>
                  <span class="btn-icon">‚úâÔ∏è</span>
                  –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="right-column">
          <!-- –ü–æ–º–æ—â—å –ø–æ –ø–æ–∏—Å–∫—É -->
          <div class="help-card">
            <div class="help-header">
              <div class="help-header-icon">üí°</div>
              <div>
                <h2>–ö–∞–∫ –Ω–∞–π—Ç–∏ —É—á–µ–Ω–∏–∫–∞</h2>
                <p>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–∏—Å–∫—É –∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é</p>
              </div>
            </div>

            <div class="help-steps">
              <div class="help-step">
                <div class="step-number">1</div>
                <div class="step-content">
                  <div class="step-title">–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–ª–∏ —Ñ–∞–º–∏–ª–∏—é</div>
                  <div class="step-desc">–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∏–º—è —É—á–µ–Ω–∏–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ —Å–∏—Å—Ç–µ–º–µ</div>
                </div>
              </div>

              <div class="help-step">
                <div class="step-number">2</div>
                <div class="step-content">
                  <div class="step-title">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞</div>
                  <div class="step-desc">–°–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∂–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —É—á–µ–Ω–∏–∫–æ–≤ –∏–∑ –≤–∞—à–µ–π —à–∫–æ–ª—ã</div>
                </div>
              </div>

              <div class="help-step">
                <div class="step-number">3</div>
                <div class="step-content">
                  <div class="step-title">–û—Ç–ø—Ä–∞–≤—å—Ç–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</div>
                  <div class="step-desc">–£—á–µ–Ω–∏–∫ –ø–æ–ª—É—á–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–∏ –≤ –∫–ª–∞—Å—Å</div>
                </div>
              </div>
            </div>
          </div>

          <!-- –ü—Ä–∏–º–µ—Ä—ã –ø–æ–∏—Å–∫–∞ -->
          <div class="example-card">
            <div class="example-header">
              <div class="example-header-icon">üìã</div>
              <div>
                <h2>–ü—Ä–∏–º–µ—Ä—ã –ø–æ–∏—Å–∫–∞</h2>
                <p>–ö–∞–∫ –ª—É—á—à–µ –∏—Å–∫–∞—Ç—å —É—á–µ–Ω–∏–∫–æ–≤</p>
              </div>
            </div>

            <div class="example-content">
              <div class="example-item">
                <div class="example-icon">üë®‚Äçüéì</div>
                <div>
                  <h3>–ü–æ –∏–º–µ–Ω–∏ –∏ —Ñ–∞–º–∏–ª–∏–∏</h3>
                  <p>–í–≤–µ–¥–∏—Ç–µ "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤" –∏–ª–∏ —Ç–æ–ª—å–∫–æ "–ò–≤–∞–Ω" –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—Å–µ—Ö –ò–≤–∞–Ω–æ–≤</p>
                </div>
              </div>

              <div class="example-item">
                <div class="example-icon">üî§</div>
                <div>
                  <h3>–ü–æ –ª–æ–≥–∏–Ω—É</h3>
                  <p>–ï—Å–ª–∏ –∑–Ω–∞–µ—Ç–µ –ª–æ–≥–∏–Ω —É—á–µ–Ω–∏–∫–∞, –≤–≤–µ–¥–∏—Ç–µ –µ–≥–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–ª–∏ —á–∞—Å—Ç–∏—á–Ω–æ</p>
                </div>
              </div>

              <div class="example-item">
                <div class="example-icon">üè´</div>
                <div>
                  <h3>–ü–æ –∫–ª–∞—Å—Å—É</h3>
                  <p>–°–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∂–µ—Ç —Ç–æ–ª—å–∫–æ —É—á–µ–Ω–∏–∫–æ–≤ –∏–∑ –≤–∞—à–µ–π —à–∫–æ–ª—ã –ì–ë–û–£ 444</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", function() {
    // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
    const userSearch = document.getElementById('userSearch');
    const searchResults = document.getElementById('searchResults');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const selectedUser = document.getElementById('selectedUser');
    const submitBtn = document.getElementById('submitBtn');
    const form = document.getElementById('inviteForm');
    
    let searchTimeout;

    // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    userSearch.addEventListener('input', function() {
      const query = this.value.trim();

      // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–∞—É—Ç
      clearTimeout(searchTimeout);

      // –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –ø—É—Å—Ç–æ–π
      if (query.length === 0) {
        searchResults.style.display = 'none';
        loadingSpinner.style.display = 'none';
        return;
      }

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
      loadingSpinner.style.display = 'block';
      searchResults.style.display = 'none';

      // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–∏—Å–∫–æ–º (–¥–µ–±–∞—É–Ω—Å)
      searchTimeout = setTimeout(() => {
        searchUsers(query);
      }, 300);
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –æ–±–ª–∞—Å—Ç–∏
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.search-container')) {
        searchResults.style.display = 'none';
        loadingSpinner.style.display = 'none';
      }
    });

    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
    form.addEventListener('submit', function(e) {
      const userId = document.getElementById('selectedUserId').value;
      
      if (!userId) {
        e.preventDefault();
        showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —É—á–µ–Ω–∏–∫–∞ –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è');
        return false;
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="btn-icon">‚è≥</span> –û—Ç–ø—Ä–∞–≤–∫–∞...';
      
      return true;
    });

    // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
    if (userSearch) {
      userSearch.focus();
    }
  });

  // –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  function searchUsers(query) {
    const loadingSpinner = document.getElementById('loadingSpinner');
    const searchResults = document.getElementById('searchResults');

    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π API endpoint
    fetch(`/accounts/api/search-users/?q=${encodeURIComponent(query)}`)
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(users => {
        loadingSpinner.style.display = 'none';
        displaySearchResults(users);
      })
      .catch(error => {
        console.error('Error searching users:', error);
        loadingSpinner.style.display = 'none';
        searchResults.innerHTML = '<div class="no-results">–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>';
        searchResults.style.display = 'block';
      });
  }

  // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
  function displaySearchResults(users) {
    const searchResults = document.getElementById('searchResults');

    if (users.length === 0) {
      searchResults.innerHTML = '<div class="no-results">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
      searchResults.style.display = 'block';
      return;
    }

    let html = '';
    users.forEach(user => {
      // –°–æ–∑–¥–∞–µ–º –∞–≤–∞—Ç–∞—Ä –∏–∑ –∏–Ω–∏—Ü–∏–∞–ª–æ–≤
      const firstName = user.first_name || '';
      const lastName = user.last_name || '';
      const avatarText = (firstName.charAt(0) + lastName.charAt(0)).toUpperCase() || user.username.charAt(0).toUpperCase();

      // –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è
      const fullName = `${firstName} ${lastName}`.trim() || user.username;

      // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Å–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
      const classInfo = user.class_number ? ` ‚Ä¢ ${user.class_number}${user.class_letter || ''} –∫–ª–∞—Å—Å` : '';

      html += `
        <div class="user-result" onclick="selectUser(${user.id}, '${firstName}', '${lastName}', '${user.username}', '${avatarText}')">
          <div class="user-avatar-small">${avatarText}</div>
          <div class="user-info-small">
            <h5>${fullName}</h5>
            <p>@${user.username}${classInfo}</p>
          </div>
        </div>
      `;
    });

    searchResults.innerHTML = html;
    searchResults.style.display = 'block';
  }

  // –í—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  function selectUser(userId, firstName, lastName, username, avatarText) {
    const selectedUser = document.getElementById('selectedUser');
    const selectedUserName = document.getElementById('selectedUserName');
    const selectedUserDetails = document.getElementById('selectedUserDetails');
    const selectedUserAvatar = document.getElementById('selectedUserAvatar');
    const selectedUserId = document.getElementById('selectedUserId');
    const userSearch = document.getElementById('userSearch');
    const searchResults = document.getElementById('searchResults');
    const submitBtn = document.getElementById('submitBtn');

    // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const fullName = `${firstName || ''} ${lastName || ''}`.trim() || username;
    selectedUserName.textContent = fullName;
    selectedUserDetails.textContent = `@${username}`;
    selectedUserAvatar.textContent = avatarText;
    selectedUserId.value = userId;

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
    selectedUser.style.display = 'block';
    searchResults.style.display = 'none';
    userSearch.value = '';

    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
    submitBtn.disabled = false;
    
    // –ê–Ω–∏–º–∞—Ü–∏—è
    selectedUser.style.animation = 'slideUp 0.3s ease';
  }

  // –û—á–∏—Å—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  function clearSelectedUser() {
    const selectedUser = document.getElementById('selectedUser');
    const selectedUserId = document.getElementById('selectedUserId');
    const submitBtn = document.getElementById('submitBtn');

    selectedUser.style.display = 'none';
    selectedUserId.value = '';
    submitBtn.disabled = true;
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
  function showError(message) {
    const errorDiv = document.createElement('div');
    errorDiv.className = 'form-errors';
    errorDiv.innerHTML = `<ul><li>${message}</li></ul>`;
    
    const existingError = document.querySelector('.form-errors');
    if (existingError) {
      existingError.remove();
    }
    
    const form = document.querySelector('.search-form');
    if (form) {
      form.prepend(errorDiv);
      
      // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –æ—à–∏–±–∫–µ
      errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }
  </script>
</body>
</html>