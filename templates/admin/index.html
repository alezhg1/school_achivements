{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}
<style>
/* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
body {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%) !important;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
}

#header {
    background: var(--gradient) !important;
    color: white !important;
    box-shadow: var(--shadow);
    border-bottom: none;
}

#branding h1 {
    color: white !important;
    font-weight: 700;
    font-size: 1.4rem;
}

.module {
    background: white !important;
    border-radius: 16px !important;
    box-shadow: var(--shadow) !important;
    border: 1px solid #e2e8f0 !important;
    margin-bottom: 25px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.module:hover {
    box-shadow: var(--shadow-lg) !important;
}

.module h2 {
    background: var(--gradient) !important;
    color: white !important;
    padding: 20px 25px !important;
    margin: 0 !important;
    font-size: 1.1rem !important;
    font-weight: 600;
    border-radius: 0 !important;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
.dashboard-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 24px;
    margin: 30px 0;
}

.stat-card {
    background: white;
    border-radius: 20px;
    padding: 30px 25px;
    box-shadow: var(--shadow);
    border: 1px solid #f1f5f9;
    text-align: center;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    border-left: 5px solid var(--primary);
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--gradient);
}

.stat-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-lg);
}

.stat-icon {
    font-size: 3rem;
    margin-bottom: 15px;
    display: block;
    opacity: 0.9;
}

.stat-number {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--dark);
    margin: 15px 0;
    display: block;
    background: var(--gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.stat-label {
    color: #64748b;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 1.2px;
    font-weight: 600;
}

/* –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è */
.quick-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 16px;
    margin: 25px 0;
    padding: 0 20px 20px;
}

.action-btn {
    background: white;
    border: 2px solid #f1f5f9;
    border-radius: 14px;
    padding: 25px 20px;
    text-decoration: none;
    color: var(--dark);
    text-align: center;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight: 600;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    position: relative;
    overflow: hidden;
}

.action-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: var(--gradient);
    transition: left 0.4s ease;
    z-index: 1;
}

.action-btn:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
    text-decoration: none;
    border-color: var(--primary);
}

.action-btn:hover::before {
    left: 0;
}

.action-btn > * {
    position: relative;
    z-index: 2;
}

.action-btn .btn-icon {
    font-size: 2.2rem;
    transition: transform 0.3s ease;
}

.action-btn:hover .btn-icon {
    transform: scale(1.1);
}

/* –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å */
.activity-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 28px;
    margin: 35px 0;
}

.activity-section {
    background: white;
    border-radius: 20px;
    padding: 0;
    box-shadow: var(--shadow);
    border: 1px solid #f1f5f9;
    overflow: hidden;
    transition: all 0.3s ease;
}

.activity-section:hover {
    box-shadow: var(--shadow-lg);
}

.activity-header {
    background: var(--gradient);
    color: white;
    padding: 20px 25px;
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
}

.activity-list {
    list-style: none;
    padding: 0;
    margin: 0;
    max-height: 350px;
    overflow-y: auto;
}

.activity-item {
    padding: 20px 25px;
    border-bottom: 1px solid #f8fafc;
    display: flex;
    align-items: center;
    gap: 16px;
    transition: all 0.3s ease;
    position: relative;
}

.activity-item:last-child {
    border-bottom: none;
}

.activity-item:hover {
    background: #f8fafc;
    transform: translateX(5px);
}

.user-avatar {
    width: 48px;
    height: 48px;
    background: var(--gradient);
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 700;
    font-size: 18px;
    flex-shrink: 0;
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
}

.activity-content {
    flex: 1;
}

.activity-title {
    font-weight: 600;
    color: var(--dark);
    margin-bottom: 6px;
    font-size: 0.95rem;
}

.activity-meta {
    color: #64748b;
    font-size: 0.8rem;
    display: flex;
    gap: 12px;
    align-items: center;
}

.status-badge {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
}

/* –ó–∞—è–≤–∫–∏ —É—á–∏—Ç–µ–ª–µ–π */
.teacher-requests {
    background: linear-gradient(135deg, #fff7ed, #ffedd5);
    border: 1px solid #fed7aa;
    border-radius: 16px;
    padding: 25px;
    margin: 25px 0;
}

.teacher-requests-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 20px;
}

.teacher-requests h3 {
    color: #ea580c;
    margin: 0;
    font-size: 1.2rem;
}

.request-count {
    background: #ea580c;
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 600;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1024px) {
    .activity-grid {
        grid-template-columns: 1fr;
        gap: 20px;
    }
}

@media (max-width: 768px) {
    .dashboard-stats {
        grid-template-columns: 1fr;
        gap: 16px;
    }

    .quick-actions {
        grid-template-columns: 1fr;
    }

    .activity-item {
        padding: 16px 20px;
    }

    .stat-card {
        padding: 25px 20px;
    }
}

/* –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–∫—Ä–æ–ª–ª–±–∞—Ä—ã */
.activity-list::-webkit-scrollbar {
    width: 8px;
}

.activity-list::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 4px;
}

.activity-list::-webkit-scrollbar-thumb {
    background: var(--gradient);
    border-radius: 4px;
}

.activity-list::-webkit-scrollbar-thumb:hover {
    background: var(--gradient-hover);
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–¥–µ—Ä–∂–µ–∫ */
.stat-card:nth-child(1) { animation-delay: 0.1s; }
.stat-card:nth-child(2) { animation-delay: 0.2s; }
.stat-card:nth-child(3) { animation-delay: 0.3s; }
.stat-card:nth-child(4) { animation-delay: 0.4s; }
.stat-card:nth-child(5) { animation-delay: 0.5s; }
.stat-card:nth-child(6) { animation-delay: 0.6s; }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container animate-fade-in">
    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
    <div class="module animate-slide-up">
        <h2>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
        <div style="padding: 25px;">
            <p style="margin: 0; color: #64748b; font-size: 1.05rem; line-height: 1.6;">
                –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π "–ú–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è". –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π,
                –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è, –∫–ª–∞—Å—Å—ã –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
            </p>
        </div>
    </div>

    <!-- –ó–∞—è–≤–∫–∏ —É—á–∏—Ç–µ–ª–µ–π -->
    {% if pending_teachers > 0 %}
    <div class="teacher-requests animate-slide-up">
        <div class="teacher-requests-header">
            <h3>‚è≥ –û–∂–∏–¥–∞—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</h3>
            <span class="request-count">{{ pending_teachers }}</span>
        </div>
        <p style="margin: 0; color: #92400e; font-size: 0.95rem;">
            –£ –≤–∞—Å {{ pending_teachers }} –∑–∞—è–≤–æ–∫ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —É—á–∏—Ç–µ–ª–µ–π.
            <a href="{% url 'admin:accounts_customuser_changelist' %}?teacher_status__exact=pending"
               style="color: #ea580c; font-weight: 600; text-decoration: none;">
                –ü–µ—Ä–µ–π—Ç–∏ –∫ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—é ‚Üí
            </a>
        </p>
    </div>
    {% endif %}

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="dashboard-stats">
        <div class="stat-card animate-slide-up">
            <span class="stat-icon">üë•</span>
            <span class="stat-number">{{ total_users }}</span>
            <span class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>
        </div>

        <div class="stat-card animate-slide-up">
            <span class="stat-icon">üë®‚Äçüè´</span>
            <span class="stat-number">{{ teachers_count }}</span>
            <span class="stat-label">–£—á–∏—Ç–µ–ª–µ–π</span>
        </div>

        <div class="stat-card animate-slide-up">
            <span class="stat-icon">üë®‚Äçüéì</span>
            <span class="stat-number">{{ students_count }}</span>
            <span class="stat-label">–£—á–µ–Ω–∏–∫–æ–≤</span>
        </div>

        <div class="stat-card animate-slide-up">
            <span class="stat-icon">üèÜ</span>
            <span class="stat-number">{{ total_achievements }}</span>
            <span class="stat-label">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–π</span>
        </div>

        <div class="stat-card animate-slide-up">
            <span class="stat-icon">üè´</span>
            <span class="stat-number">{{ total_classes }}</span>
            <span class="stat-label">–ö–ª–∞—Å—Å–æ–≤</span>
        </div>

        <div class="stat-card animate-slide-up">
            <span class="stat-icon">üìà</span>
            <span class="stat-number">{{ recent_achievements }}</span>
            <span class="stat-label">–ó–∞ –Ω–µ–¥–µ–ª—é</span>
        </div>
    </div>

    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="module animate-slide-up">
        <h2>üöÄ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
        <div class="quick-actions">
            <a href="{% url 'admin:accounts_customuser_add' %}" class="action-btn">
                <span class="btn-icon">‚ûï</span>
                –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            </a>

            <a href="{% url 'admin:accounts_achievement_add' %}" class="action-btn">
                <span class="btn-icon">üèÜ</span>
                –î–æ–±–∞–≤–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
            </a>

            <a href="{% url 'admin:accounts_classroom_add' %}" class="action-btn">
                <span class="btn-icon">üè´</span>
                –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å
            </a>

            <a href="{% url 'admin:accounts_invitation_add' %}" class="action-btn">
                <span class="btn-icon">üì®</span>
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
            </a>

            {% if pending_teachers > 0 %}
            <a href="{% url 'admin:accounts_customuser_changelist' %}?teacher_status__exact=pending" class="action-btn">
                <span class="btn-icon">‚è≥</span>
                –ó–∞—è–≤–∫–∏ —É—á–∏—Ç–µ–ª–µ–π ({{ pending_teachers }})
            </a>
            {% endif %}

            <a href="{% url 'admin:accounts_achievement_changelist' %}?year__gte=2024" class="action-btn">
                <span class="btn-icon">üÜï</span>
                –ù–æ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
            </a>
        </div>
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å -->
    <div class="activity-grid">
        <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
        <div class="activity-section animate-slide-up">
            <div class="activity-header">
                <span>üÜï –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
            </div>
            <ul class="activity-list">
                {% for user in latest_users %}
                <li class="activity-item">
                    <div class="user-avatar">
                        {{ user.first_name|first|default:user.username|first|upper }}
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">
                            {{ user.get_full_name|default:user.username }}
                        </div>
                        <div class="activity-meta">
                            <span>{{ user.date_joined|date:"d.m.Y" }}</span>
                            {% if user.role == 'teacher' %}
                            <span class="status-badge" style="background: #dbeafe; color: #1e40af;">üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—å</span>
                            {% else %}
                            <span class="status-badge" style="background: #dcfce7; color: #166534;">üë®‚Äçüéì –£—á–µ–Ω–∏–∫</span>
                            {% endif %}
                        </div>
                    </div>
                </li>
                {% empty %}
                <li class="activity-item" style="justify-content: center; color: #94a3b8; font-style: italic;">
                    –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                </li>
                {% endfor %}
            </ul>
        </div>

        <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
        <div class="activity-section animate-slide-up">
            <div class="activity-header">
                <span>üèÜ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</span>
            </div>
            <ul class="activity-list">
                {% for achievement in latest_achievements %}
                <li class="activity-item">
                    <div class="user-avatar" style="background: {% if achievement.result == '–ü–æ–±–µ–¥–∏—Ç–µ–ª—å' %}linear-gradient(135deg, #f59e0b, #d97706){% elif achievement.result == '–ü—Ä–∏–∑—ë—Ä' %}linear-gradient(135deg, #94a3b8, #64748b){% else %}linear-gradient(135deg, #06b6d4, #0891b2){% endif %};">
                        {% if achievement.result == '–ü–æ–±–µ–¥–∏—Ç–µ–ª—å' %}ü•á
                        {% elif achievement.result == '–ü—Ä–∏–∑—ë—Ä' %}ü•à
                        {% else %}üéØ{% endif %}
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">
                            {{ achievement.title|truncatechars:40 }}
                        </div>
                        <div class="activity-meta">
                            <span>{{ achievement.student.get_full_name|default:achievement.student.username }}</span>
                            <span>{{ achievement.created_at|date:"d.m.Y" }}</span>
                        </div>
                    </div>
                </li>
                {% empty %}
                <li class="activity-item" style="justify-content: center; color: #94a3b8; font-style: italic;">
                    –ù–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏ Django -->
    <div class="animate-slide-up" style="animation-delay: 0.3s;">
        {{ block.super }}
    </div>
</div>
{% endblock %}